(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1248:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.I13nButton=t.I13nAnchor=undefined,t.fireRapidPageView=function(e){var t=a.ReactI13n.getInstance();t&&t.execute("pageview",{pageParams:{pd:"canvass-"+e,navtype:"client"}})},t.fireRapidEvent=function(e,t){var n={sec:"cmmts",subsec:"canvass",outcm:"show"};t&&(n=Object.assign(n,t));var s=a.ReactI13n.getInstance();s&&s.execute("beacon",{beaconType:"beaconEvent",arguments:[e,n,n.outcm]})},t.fireRapidClick=function(e){var t={sec:"cmmts",_p:"0",subsec:"canvass",outcm:"clicked"};e&&(t=Object.assign(t,e));var n=a.ReactI13n.getInstance();n&&n.execute("beacon",{beaconType:"beaconClick",arguments:[t.sec,t.slk||"-",t._p,t,t.outcm]})},t.getI13nModel=function(e,t){if(!s[e])throw new Error('There is no I13nModel for "'+e+'"');return t?Object.assign({},s[e],t):s[e]};var a=n(322),s=(t.I13nAnchor=(0,a.createI13nNode)("a",{bindClickEvent:!0,follow:!0,isLeafNode:!1}),t.I13nButton=(0,a.createI13nNode)("button",{bindClickEvent:!0,isLeafNode:!1}),{login:{slk:"login",elm:"cmmt_login",itc:0,outcm:"login"},"comments-open":{slk:"show",elm:"cmmt_open",outcm:"open"},"comments-close":{slk:"hide",elm:"cmmt_open",outcm:"close"},"comments-showMore":{slk:"load more",elm:"cmmt_more",outcm:"more"},"comments-showNew":{slk:"load new",elm:"cmmt_new",outcm:"more"},"comment-delete":{slk:"delete",elm:"cmmt_delete",itc:1,outcm:"delete"},"comment-replies":{elm:"cmmt_body"},"comment-report-cancel":{slk:"close",elm:"cmmt_abuse",outcm:"close"},"comment-flag":{slk:"abuse",elm:"cmmt_abuse",itc:1,outcm:"open"},"comment-block":{slk:"mute",elm:"cmmt_mute",outcm:"close"},"comment-report-done":{elm:"cmmt_abuse",outcm:"close",itc:1},"comment-post":{slk:"post",elm:"cmmt_post",outcm:"post"},"comment-seemore":{slk:"read more",elm:"cmmt_read",outcm:"read"},guidelines:{slk:"guideline show",elm:"cmmt_guideline"},options:{elm:"cmmt_options",slk:"options",outcm:"options"},"replies-show":{slk:"open replies",elm:"cmmt_more",elmt:"showreply",outcm:"show"},reply:{slk:"open reply",elm:"cmmt_reply",outcm:"focus"},"reply-post":{slk:"post reply",elm:"cmmt_reply",outcm:"post"},react:{slk:"open reactions",elm:"cmmt_react"},vote:{elm:"cmmt_vote",outcm:"rate"},link:{slk:"smartlink",elm:"cmmt_link",itc:0,outcm:"navigate"},"context-link":{elm:"cmmt_ctx",itc:0},"tumblr-icon":{slk:"gif-show",elm:"cmmt_gif",outcm:"show"},"tumblr-post":{elm:"cmmt_gif",outcm:"post"},"link-prvw-close":{slk:"link-prvw-close",elm:"cmmt_link",outcm:"close"},"text-input":{slk:"text-input",elm:"cmmt_text",outcm:"focus"},sort:{elm:"cmmt_sort",outcm:"sort"},"sort-btn":{elm:"cmmt_sort_btn"},"user-avatar-tap":{slk:"open user messages",elm:"cmmt_avatar",outcm:"history"},"user-comments-tap":{slk:"open user messages",elm:"cmmt_history",outcm:"history"},"user-name-tap":{slk:"open user messages",elm:"cmmt_username",outcm:"history"},"user-close-tap":{slk:"close user messages",elm:"cmmt_username",outcm:"history"},"related-tags":{elm:"cmmt_trending_tag"},"sentiments-tap":{slk:"sentiments",elm:"cmmt_sentiments",outcm:"show"},"sentiments-close-tap":{slk:"sentiments close",elm:"cmmt_sentiments",outcm:"hide"},userlabels:{slk:"userlabels show",elm:"cmmt_userlabels"},"userlabels-tap":{elm:"cmmt_userlabels"}})},1280:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){return t.forEach((function(t){e[t]=e[t].bind(e)})),e},e.exports=t["default"]},1597:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(1172)),s=u(n(1181)),o=u(n(0)),r=u(n(1)),i=u(n(182)),l=u(n(1630));function u(e){return e&&e.__esModule?e:{"default":e}}var c=(0,o["default"])("Canvass:actions:expandMessages");function d(e,t,n){c("expand",t);var o=t&&(t.id||t.instanceId);if(!o)return n&&n(new Error("expandMessages requires an instanceId"));var u=e.session.query,d=e.getStore(s["default"]).getState(),f=e.getStore(a["default"]),p=f.getCommentsState(o),m=p.get("messageList")||i["default"].List(),h={id:o,instanceId:o,isExpanded:(0,r["default"])(t,["expanded"],!0)};if(!h.isExpanded||m.size>0||h.isExpanded===p.get("expanded"))e.dispatch("COMMENTS_EXPAND",h),n&&n();else{var g={apiVersion:d.apiVersion,context:t.uuid||t.context||u.context||"YahooGlobal",contextDisplayText:t.contextDisplayText||p.get("contextDisplayText"),contextUrl:t.contextUrl||p.get("contextUrl"),cpNamespace:d.cpNamespace,expanded:!0,index:t.nextIndex||null,instanceId:o,lang:d.lang,messagesPerPage:d.messagesPerPage,namespace:t.namespace||p.get("namespace")||d.namespace,region:d.region,selectedTags:t.selectedTags,sortBy:t.sortBy||p.get("sortBy"),tagsAnd:t.tagsAnd,tagsOr:t.tagsOr,oauthConsumerKey:d.oauthConsumerKey,oauthConsumerSecret:d.oauthConsumerSecret};e.executeAction(l["default"],g,(function(t,a){f.getCommentsState(o).get("error")||e.dispatch("COMMENTS_EXPAND",h),n&&n()}))}}d.displayName="expandMessages",t["default"]=d,e.exports=t["default"]},1759:function(e,t,n){"use strict";var a=/\s+/g,s=/\(.+\)/,o=n(120);function r(e){this._styles={},e&&this.set(e)}function i(e){return e?(Array.isArray(e)&&(e=e.join(" ")),"object"==typeof e&&(e=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&e[t]&&(n+=" "+t);return n}(e)),e.trim().split(a)):[]}function l(e,t){return e[t.replace(s,"")]=t,e}function u(e){return i(e).reduce(l,{})}function c(e){return Object.keys(e).map((function(t){return e[t]})).join(" ")}function d(e,t){return o(e,u(t))}r.prototype={set:function f(e){if(Array.isArray(e))return e.forEach(f,this);Object.keys(e).forEach((function(t){this._styles[t]=o(this._styles[t]||{},u(e[t]))}),this)},get:function(e,t){var n={};return i(e).forEach((function(e){o(n,this._styles[e])}),this),t&&o(n,u(t)),c(n)},dedupe:function(){return c([].reduce.call(arguments,d,{}))}},e.exports=r},2100:function(e,t,n){"use strict";var a=n(1759);e.exports=new a},2101:function(e,t,n){"use strict";function a(e){var t=e.session.protocol+"://"+e.session.host;try{var n=(e.getStore("RouteStore").getCurrentNavigate()||{}).url;return n?t+n:location.href}catch(a){return t}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRoute=a,t.getLoginUrl=function(e,t,n,s){var o="https://login.yahoo.com/";if(!e||!e.session)return o+"?.intl=US&.lang=en-US&.done="+encodeURIComponent("https://www.yahoo.com");var r=e.session.dimensions||{},i=e.session.query||{},l=(e.contextUrl||i.contextUrl||a(e))+"?bcmt=1";t&&(l+="&messageId="+encodeURIComponent(t));n&&(l+="&replyId="+encodeURIComponent(n));return o+"?.intl="+r.intl+"&.lang="+r.lang+"&.done="+encodeURIComponent(l)+(s?"&.src="+encodeURIComponent(s):"")}},2249:function(e,t,n){var a=n(2100);a.set({btn:"Fz(14px) Fw(b) Bdw(0) Ta(c) Cur(p) Va(m) Bdrs(4px) O(n)! Lh(n)","btn-primary":"Bgc($c-fuji-blue-1-a) Bgc($c-fuji-blue-3-a):h C(#fff) Bd(n)","btn-secondary":"Bgc(#fff) C($c-fuji-blue-1-a) Bdw(2px) Bdc($c-fuji-blue-1-a) Bd C(#fff):h Bgc($c-fuji-blue-1-a):h","btn-spacing":"Mt(20px) Mb(20px) Px(30px) Py(10px)","btn-fullwidth-sm":"W(100%)--xs Bdrs(2px)--xs Bdw(1px)--xs Fw(600)--xs Py(12px)--xs"}),e.exports=a},2250:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(13);var o=(0,((a=s)&&a.__esModule?a:{"default":a})["default"])({storeName:"CanvassCommentFormStore",statics:{handlers:{CANVASS_HEARTBEAT_SUCCESS:"heartbeatSuccess",CANVASS_POST_FAILURE:"canvassFailure",CANVASS_POST_SUCCESS:"canvassSuccess"}},initialize:function(){this.state={activeForm:null,commenting:{},errorMessage:""}},canvassFailure:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state.errorMessage="CANVASS_NETWORK_ERROR",this.state.messageId=e.messageId,this.state.replyId=null,this.emitChange()},canvassSuccess:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state=Object.assign(this.state,e,{errorMessage:"",replyId:e.replyId||null}),this.emitChange()},isActiveForm:function(e){var t=this.state.activeForm;return!!t&&t.messageId===e.messageId&&t.replyId===e.replyId},getActiveForm:function(){return this.state.activeForm||{}},setActiveForm:function(e){this.isActiveForm(e)||(this.state.activeForm={messageId:e.messageId,replyId:e.replyId},this.emitChange())},setFormInactive:function(e){this.isActiveForm(e)&&(this.state.activeForm=e.replyId?{messageId:e.messageId}:null,this.emitChange())},setCommentingState:function(e,t){e&&(this.state.commenting[e]||!1)!==t&&(this.state.commenting=Object.assign({},this.state.commenting),this.state.commenting[e]=t,this.emitChange())},heartbeatSuccess:function(e){var t=e.eventType,n=e.messageId||e.context;"START_TYPING"===t&&n?this.setCommentingState(n,!0):"STOP_TYPING"===t&&n&&this.setCommentingState(n,!1)},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}});t["default"]=o,e.exports=t["default"]},2251:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),r=n(4);a=r;var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={shouldRender:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentDidMount",value:function(){this.setState({shouldRender:!0})}},{key:"render",value:function(){return this.state.shouldRender?this.props.children:null}}]),t}(o.Component);t["default"]=i,e.exports=t["default"]},2252:function(e,t,n){"use strict";function a(e,t,n){if(!parent)return n&&n();parent===window?window.location.href=t.loginUrl:parent.postMessage(JSON.stringify({context:t.context,isCanvass:!0,loginUrl:t.loginUrl}),"*"),n&&n()}Object.defineProperty(t,"__esModule",{value:!0}),a.displayName="loginUser",t["default"]=a,e.exports=t["default"]},2482:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(1)),s=r(n(1181)),o=n(1855);function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){var r=e.getStore(s["default"]).getState(),i=Object.assign({},t,{apiVersion:r.apiVersion,cpNamespace:r.cpNamespace,lang:r.lang,region:r.region,oauthConsumerKey:r.oauthConsumerKey,oauthConsumerSecret:r.oauthConsumerSecret});if(!i.guid||!i.oauthConsumerSecret||!i.oauthConsumerKey)return n();var l={apiVersion:i.apiVersion,cpNamespace:i.cpNamespace,userId:i.guid,sortBy:i.sortBy||o.DEFAULT_SORT,index:i.nextIndex||null,count:i.count||10,lang:i.lang||"en-US",region:i.region||"US",oauthConsumerKey:i.oauthConsumerKey,oauthConsumerSecret:i.oauthConsumerSecret};e.service.read("canvass.getUserMessageHistory",l,{},(function(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_USER_HISTORY_GET_FAILURE",t),n&&n();var o=s.canvassMessages||[];e.dispatch("CANVASS_USER_HISTORY_GET_SUCCESS",{messageList:o,instanceId:i.instanceId,count:s.total&&s.total.count||0,startIndex:(0,a["default"])(o,[0,"index"],null),nextIndex:(0,a["default"])(o,[o.length-1,"index"],null),sortBy:l.sortBy,showNextClicked:i.showNextClicked,guid:i.guid,image:i.image,name:i.name}),n&&n()}))}i.displayName="loadUserMessages",t["default"]=i,e.exports=t["default"]},2483:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){if(!parent||parent===window)return n&&n();var s;if(t.hasOwnProperty("height"))s=t.height;else{var o=document.querySelector(".render-target-active")||document.scrollingElement||document.body;s=o.scrollHeight}s!==a&&(a=s,parent.postMessage(JSON.stringify({context:t.context,count:t.count||0,height:a,initialized:!0,isCanvass:!0,isExpanded:t.isExpanded}),"*"));n&&n()},e.exports=t["default"]},2484:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=u(n(4)),o=n(2),r=u(o),i=u(n(1084)),l=u(n(3372));function u(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){return c(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"renderCommentNode",value:function(e,t){var n=this.props,a=n.cpos,s=a===undefined?null:a,o=n.deepLink,u=o===undefined?{}:o,c=e.tags,d=e&&e.meta&&e.meta.contextInfo||{},f=d.url||n.parentContextUrl||"",p=d.displayText||n.parentContextDisplayText||"",m=u.replyId&&u.replyId===e.replyId,h=(0,i["default"])(n.itemClassName,{"Bgc(#f4f9ff)":m||!m&&!e.replyId&&u.messageId===e.messageId}),g=null===s;return r["default"].createElement(l["default"],{className:h,contextId:e.contextId,cpos:g?t:s,data:e,isReadOnly:n.isReadOnly,key:"comment-"+(e.replyId||e.messageId),messageNamespace:e.namespace,parentContextDisplayText:p,parentContextUrl:f,parentTags:g&&c.length?c:[],pos:g?null:t,replySortBy:n.replySortBy,seeMore:this.context.componentConfig.ui.seeMore,sortBy:n.sortBy})}},{key:"render",value:function(){var e=this.props,t=e.list;return t&&t.length?r["default"].createElement("ul",{className:(0,i["default"])("comments-list List(n) Ovs(touch) Pos(r)",e.className)},t.map(this.renderCommentNode,this)):null}}]),t}(o.PureComponent);f.defaultProps={cpos:null,isReadOnly:!1,itemClassName:"",list:[],sortBy:""},f.contextTypes={componentConfig:s["default"].object.isRequired},t["default"]=f,e.exports=t["default"]},2485:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(182)),s=r(n(2187)),o=r(n(1));function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e.getIn(["gifs",0,"image","resolutions"])}function l(e){return e.get("blogName","")}t["default"]=(0,s["default"])({storeName:"CanvassTumblrStore",statics:{handlers:{TUMBLR_RELOAD:"reloadCache",TUMBLR_LOAD_GIFS:"loadGifs",TUMBLR_LOAD_GIFS_ERROR:"loadGifsError"}},initialize:function(){this._state=a["default"].fromJS({data:{}})},reloadCache:function(){return this.emitChange()},loadGifs:function(e){var t=e.key,n=a["default"].fromJS(e.data.gifresult),s=(0,o["default"])(e,["data","offset"],0),r=n.map(i),u=n.map(l);e.offset&&this.get("data").getIn([t]).size&&(r=this.get("data").getIn([t,"stickers"]).concat(r),u=this.get("data").getIn([t,"authors"]).concat(u)),this.mergeState({data:this.get("data").mergeIn([t],{stickers:r,authors:u,offset:s,error:null})})},loadGifsError:function(e){var t=e.key,n=this.get("data").getIn([t,"error"]),a=e.error||"TUMBLR_LOAD_ERROR";if(a===n)return this.emitChange();var s=null,o=null;e.offset&&this.get("data").getIn([t]).size&&(s=this.get("data").getIn([t,"stickers"]),o=this.get("data").getIn([t,"authors"])),this.mergeState({data:this.get("data").mergeIn([t],{stickers:s,authors:o,offset:e.offset,error:a})})}}),e.exports=t["default"]},2783:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(182)),s=o(n(2187));function o(e){return e&&e.__esModule?e:{"default":e}}t["default"]=(0,s["default"])({storeName:"CanvassSentimentsStore",handlers:{CANVASS_GET_SENTIMENTS_SUCCESS:"_getSentimentsSuccess"},initialize:function(){this._state=a["default"].fromJS({sentiments:{}})},_getSentimentsSuccess:function(e){e.instanceId&&e.sentiments&&this.mergeState(this._state.setIn(["sentiments",e.instanceId],a["default"].fromJS(e.sentiments)))},getSentiments:function(e){return this._state.getIn(["sentiments",e],a["default"].List())}}),e.exports=t["default"]},2784:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var a="clear"===t.voteType?"delete":"update",s=t.replyId?"canvass.voteReply_ns":"canvass.voteMessage_ns",r=e.getStore(o["default"]).getState(),i=Object.assign({apiVersion:r.apiVersion,cpNamespace:r.cpNamespace,lang:r.lang,region:r.region,oauthConsumerKey:r.oauthConsumerKey,oauthConsumerSecret:r.oauthConsumerSecret},t);function l(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_VOTE_FAILURE",t),n();e.dispatch("CANVASS_VOTE_SUCCESS",i),n()}"update"===a?e.service.update(s,i,{},{},(function(e,t){l(e,t)})):"delete"===a&&e.service["delete"](s,i,{},(function(e,t){l(e,t)}))};var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};e.exports=t["default"]},2785:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=f(n(4)),r=n(2),i=f(r),l=f(n(1280)),u=n(322),c=n(34),d=n(1248);function f(e){return e&&e.__esModule?e:{"default":e}}var p=(0,u.createI13nNode)("textarea",{bindClickEvent:!0}),m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,l["default"])(n,["onKeyDown"]),n.state={height:"auto",rows:n.props.rows},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this.props.value,t=e&&e.length;if(t){var n=(0,c.findDOMNode)(this);n&&(n.value=e,n.setSelectionRange&&n.setSelectionRange(t,t))}}},{key:"componentDidUpdate",value:function(e,t){t.rows!==this.state.rows&&this.context.handleResize()}},{key:"onKeyDown",value:function(e){if("Enter"===e.key&&this.setState({rows:this.state.rows+1}),"Backspace"===e.key&&1!==this.state.rows){var t=e.target.value.split("\n");t[t.length-1]||this.setState({rows:this.state.rows-1})}}},{key:"render",value:function(){var e=Object.assign({},this.props);return delete e.hasAutoExpand,delete e.value,i["default"].createElement(p,a({},e,{i13nModel:(0,d.getI13nModel)("text-input"),onKeyDown:this.onKeyDown,rows:this.state.rows,style:{resize:"none"}}))}}]),t}(r.PureComponent);m.defaultProps={className:"text-area",hasAutoExpand:!0},m.contextTypes={handleResize:o["default"].func.isRequired},t["default"]=m,e.exports=t["default"]},2786:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=m(n(4)),o=n(2),r=m(o),i=m(n(1280)),l=n(34),u=m(n(1)),c=n(1248),d=n(2101),f=m(n(2252)),p=m(n(1312));function m(e){return e&&e.__esModule?e:{"default":e}}var h=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),s=(0,u["default"])(n,["componentConfig","ui","loginSrc"]);return(0,i["default"])(a,["setLoginLink"]),a.state={loginUrl:(0,d.getLoginUrl)(n,e.messageId,e.replyId,s)},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillMount",value:function(){this.onLoginClick=this.onLoginClick.bind(this)}},{key:"componentDidMount",value:function(){this.loginLink.focus()}},{key:"handleClickOutside",value:function(e){this.props.handleToggleToolTip()}},{key:"onLoginClick",value:function(){var e=this.context;e.executeAction(f["default"],{context:e.context,loginUrl:this.state.loginUrl})}},{key:"setLoginLink",value:function(e){this.loginLink=(0,l.findDOMNode)(e)}},{key:"render",value:function(){var e=this.context,t=this.props.className,n="CANVASS_PLEASE_SIGN_IN"+("2"===e.session.dimensions.authed?"_AGAIN":"");return r["default"].createElement("div",{className:"tooltip Bgc(#fff) Bd Bdrs(3px) Bdc(#d8dade) Pos(a) Z(1) Whs(nw) Start(50%) TranslateX(-50%)"+(t?" "+t:"")},r["default"].createElement(c.I13nAnchor,{className:"tooltip-signin C($fg-link) D(ib) P(10px)",follow:!1,href:this.state.loginUrl,i13nModel:(0,c.getI13nModel)("login"),onClick:this.onLoginClick,ref:this.setLoginLink,target:"_top"},e.intl.formatMessage({id:n})))}}]),t}(o.PureComponent);h.contextTypes={componentConfig:s["default"].object.isRequired,context:s["default"].string,executeAction:s["default"].func.isRequired,intl:s["default"].object,session:s["default"].object},t["default"]=(0,p["default"])(h),e.exports=t["default"]},2787:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(4)),s=f(n(2)),o=f(n(1084)),r=n(1248),i=f(n(1580)),l=f(n(2251)),u=n(322),c=n(321),d=f(n(2788));function f(e){return e&&e.__esModule?e:{"default":e}}var p=(0,u.createI13nNode)(i["default"],{isLeafNode:!1}),m=function(e,t){var n=e.creator,a=e.fromCommentForm,i=a===undefined?null:a,l=e.imageUrl,c=e.isReply,d=t.intl,f=t.isUserMessageHistory,m=t.handleUserMessages,h=t.pos,g=h===undefined?null:h,y=n===t.guid,v=m&&!f&&!e.isReadOnly,x=e.name;x=x||d.formatMessage({id:"CANVASS_ANONYMOUS"});var b=v?m.bind(undefined,n,l,x):null,S=y?d.formatMessage({id:"CANVASS_SEE_MY_HISTORY"}):d.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:x}),C=(0,o["default"])("Bdrs(46.5%) Pos(a) Start(0)",{"Cur(p)":v}),_=v?u.I13nButton:u.I13nDiv,E=(0,o["default"])("D(ib) Fw(b) P(0) Bd(0) M(0) Mend(10px) Fz(14px) Ta(start)",{"C($c-fuji-grey-l)":!v,"C($c-fuji-blue-1-a)":v}),M=c||null!==g?28:40;return[s["default"].createElement(p,{bindClickEvent:v,i13nModel:(0,r.getI13nModel)("user-avatar-tap"),key:"avatar",className:C,enableAlphatar:!0,forceLoad:!0,name:x,onClick:b,size:M,src:l,title:f?"":S}),i?null:s["default"].createElement(_,{"aria-label":v?S:undefined,bindClickEvent:v,className:E,i13nModel:(0,r.getI13nModel)("user-name-tap"),key:"username",onClick:b},x)]},h=function(e,t){var n=t.intl,a=e.fromCommentForm,r=e.activityAt,i=e.createdAt,u=e.replyCount,f=e.sortBy,p=(0,o["default"])("Fz(13px)",{"Mend(20px)":!a,"Mt(14px) Fl(start)":a,"Mt(20px)":a&&e.isReply}),h="newest"===f&&u&&r&&r!==i,g=t.isUserMessageHistory&&e.replyId&&null===e.pos;return s["default"].createElement("div",{className:p},m.call(undefined,e,t),i?s["default"].createElement(l["default"],null,s["default"].createElement("span",{className:"C($c-fuji-grey-g) Fz(12px)"},s["default"].createElement("span",{className:g?"Mend(12px)":undefined},n.formatRelative(i)),h?s["default"].createElement("span",null,s["default"].createElement("i",{"aria-hidden":"true",className:"Mx(8px)"},"•"),n.formatMessage({id:"CANVASS_LAST_REPLY_TIME"},{timeAgo:n.formatRelative(r)})):undefined,g?s["default"].createElement("span",{className:"Whs(nw)"},s["default"].createElement(c.Icon,{asset:d["default"],className:"Mend(2px) Mb(2px)",color:"#878c91",cursorClass:"Cur(d)",height:12,width:12,style:{verticalAlign:"middle"}}),n.formatMessage({id:"CANVASS_REPLIED"})):undefined)):null)};h.contextTypes={guid:a["default"].string,handleUserMessages:a["default"].func,intl:a["default"].object.isRequired,isUserMessageHistory:a["default"].bool,pos:a["default"].number},t["default"]=h,e.exports=t["default"]},2788:function(e,t,n){if(void 0===a)var a={};a.reply={name:"reply",height:20,width:25,path:"M12.8 5.8V2.4c0-.4-.2-.7-.6-.8-.3-.2-.8-.1-1.1.1L.9 8.8c-.2.2-.4.4-.4.7s.2.6.4.8l10.2 7.1c.3.2.7.3 1.1.1.3-.2.6-.5.6-.8v-3.3h1.3c3 0 6.1.6 8.5 5.2.2.3.5.5.9.5h.3c.5-.1.8-.6.7-1C23 7.3 18.5 5.9 12.8 5.8zm-.1 5.6h-1c-.6 0-1 .4-1 .9v2.4L3.2 9.5l7.5-5.2v2.4c0 .5.5.9 1 .9 4.2 0 7.9 0 9.8 6.3-2.9-2.6-6.3-2.6-8.8-2.5z"},e.exports&&(e.exports=a.reply)},2789:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=h(n(4)),o=n(2),r=h(o),i=h(n(2100)),l=h(n(1280)),u=n(1248),c=h(n(1)),d=h(n(2251)),f=h(n(329)),p=n(322),m=n(321);function h(e){return e&&e.__esModule?e:{"default":e}}var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,l["default"])(n,["handleClick","handleImgError","handleRemoveImage"]),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"handleRemoveImage",value:function(e){this.props.onLinkUpdate(!1,!0),(0,u.fireRapidClick)({slk:"link-prvw-close",elm:"cmmt_link",itc:1,outcm:"close"}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},{key:"handleImgError",value:function(e){e.target.classList.add("D(n)!")}},{key:"handleClick",value:function(){var e=this.props,t=e.enhancedLink;if(e.fromStream){var n=this.context.i13n.getI13nNode().getMergedModel();n.slk="smartlink",n.elm="cmmt_link",n.itc=0,n.outcm="navigate",(0,u.fireRapidClick)(n),t.url&&window.open(t.url)}}},{key:"renderImg",value:function(){var e=this.props.enhancedLink,t=(0,c["default"])(e,["image","url"],null);return t&&r["default"].createElement(d["default"],null,r["default"].createElement("img",{alt:e.title,className:"D(b) Bxz(bb) Mih(100px) Mah(200px) Maw(145px) W(a) Mend(5px) P(5px) Fl(start) Maw(n)--xxs W(100%)--xxs Fl(n)--xxs",onError:this.handleImgError,src:t}))}},{key:"render",value:function(){var e=this.props,t=e.enhancedLink,n=e.fromStream,a=this.context,s=a.contextId,o=a.tags;if(!t)return null;var l=t.title,c=l===undefined?"":l,d=t.description,h=d===undefined?"":d,g=t.url,y=g.indexOf("://")>-1?g.split("/")[2]:g.split("/")[0];n||(0,u.fireRapidEvent)("secvw",{slk:"link-prvw-"+g,elm:"cmmnt_link",itc:1,outcm:"show",cat:o,g:s});var v=i["default"].dedupe("Cf Bxsh(boxShadow) Mx(14px) panel Pos(r) Miw(150px) Lh(14px) Bgc(#fff) Bg(#fff) Bdrs(3px) Bdc(#d9d9d9) Bds(s) Bdw(1px) Mb(10px)",{"Cur(p) Mx(0) Mb(5px)":n});return r["default"].createElement(p.I13nDiv,{bindClickEvent:!1,className:v,onClick:this.handleClick},this.renderImg(),r["default"].createElement("div",{className:"P(5px)"},!1===n?r["default"].createElement(u.I13nButton,{className:"Pos(a) End(-10px) T(-10px) Bgc(#000) Op(0.8) Bdrs(50%) M(0) P(0) W(21px) H(21px)",i13nModel:(0,u.getI13nModel)("link-prvw-close"),onClick:this.handleRemoveImage},r["default"].createElement(m.Icon,{asset:f["default"],width:13,height:13,color:"#fff",className:"Va(bl)!"})):null,r["default"].createElement("div",{className:"LineClamp(2,54px) Fz(16px) Pt(5px) C($c-fuji-blue-4-b) Lh(18px) Mah(54px) Fw(500) Ov(h) Tov(e)"},c),r["default"].createElement("div",{className:"LineClamp(2,42px) D(n)!--xxs Fz(13px) Mt(10px) Lh(14px) Mah(42px) Ov(h) Tov(e)"},h),r["default"].createElement("div",{className:"Fz(11px) Td(n) Fw(n) D(ib) Mt(5px)!--xxs Mt(10px) Ell"},y)))}}]),t}(o.PureComponent);g.contextTypes={configStoreState:s["default"].object,contextId:s["default"].string,cpos:s["default"].number,i13n:s["default"].object,isUserMessageHistory:s["default"].bool,pos:s["default"].number,tags:s["default"].string,userMessageHistoryGuid:s["default"].string},t["default"]=g,e.exports=t["default"]},2790:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentForm=undefined;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=D(n(4)),r=n(2),i=D(r),l=D(n(2100)),u=D(n(1280)),c=D(n(1084)),d=n(34),f=D(n(1)),p=n(1603),m=n(1248),h=n(2101),g=D(n(183)),y=D(n(1172)),v=D(n(2250)),x=D(n(1181)),b=D(n(2791)),S=D(n(1136)),C=D(n(3380)),_=D(n(2683)),E=D(n(2792)),M=D(n(2252)),k=D(n(3381)),T=D(n(3382)),I=D(n(2787)),O=D(n(1447)),N=D(n(1636)),w=n(85),A=n(322),R=n(321),P=D(n(2789)),j=D(n(3383)),L=D(n(3384)),F=D(n(2785)),B=D(n(3385)),U=D(n(2793));function D(e){return e&&e.__esModule?e:{"default":e}}var H=t.CommentForm=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),s=(0,f["default"])(n,["componentConfig","ui","loginSrc"]);return a.state={activeTab:null,commenting:!1,enableRelatedTags:!1,enhancedLink:!1,enhancedLinkRemoved:!1,errorStatus:null,loginUrl:(0,h.getLoginUrl)(n,e.messageId,e.replyId,s),posting:!1,selectedUserLabel:null,titleHovered:!1,validComment:!1},(0,u["default"])(a,["handleBlur","handleCloseCommentForm","handleFocus","handleHeartbeatInterval","handleKeyUp","handleLinkUpdate","handleLoginLink","handlePaste","handlePost","handleRelatedTags","handleRemoveRelatedTags","handleShowTumblrStickers","handleSubmit","handleTitleClick","handleUserIdle","handleUserLabelSelection","onKeyDown","onTitleHover"]),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentWillMount",value:function(){var e=this.context;this.canvassStore=e.getStore(y["default"]),this.commentFormStore=e.getStore(v["default"])}},{key:"componentDidMount",value:function(){var e=this;e.handleCommentChanged(!!e.getCommentText()),e.props.isProfileLoaded||e.context.executeAction(_["default"]),setImmediate((function(){e.handleReplyFormInFocus()}))}},{key:"componentWillUnmount",value:function(){this.setCommentingState(!1),clearTimeout(this.heartbeat),clearTimeout(this.userIdleTimer),this.commentFormStore.setFormInactive(this.props)}},{key:"getCommentText",value:function(){return(((0,d.findDOMNode)(this.refs.commentText)||{}).value||"").trim()}},{key:"handleCloseCommentForm",value:function(){this.props.handleCloseCommentForm()}},{key:"handleReplyFormInFocus",value:function(){var e=this.props,t=(0,d.findDOMNode)(e.isSignedIn?this.refs.commentText:this.refs.loginPrompt);e.replyFormInFocus&&t&&t.focus()}},{key:"componentDidUpdate",value:function(){this.handleReplyFormInFocus(),this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=e.enhancedLink,n=e.commentForm,a=e.forReply,s=this.refs.submit,o=this.props,r=!o.isHidden&&e.isHidden,i=void 0;s&&this.state.posting&&!n.errorMessage&&(a&&n.messageId===o.messageId&&n.replyId||!a&&n.messageId&&!n.replyId)&&(this.handleLinkUpdate(!1,!1),this.setState({activeTab:null,commenting:!1,posting:!1,selectedUserLabel:null,validComment:!1}),i={animated_gif_count:(0,f["default"])(n,["details","imageMessageDetails","length"])||0,msg_id:n.replyId||n.messageId,rcv_msg_id:n.replyId?n.messageId:null,smartlink_count:(0,f["default"])(n,["details","linkMessageDetails","length"])||0,tags_count:n.tags.length},(0,d.findDOMNode)(this.refs.commentText).value="",r=!0);n.messageId===o.messageId&&"CANVASS_NETWORK_ERROR"===n.errorMessage&&(this.setState({errorStatus:"CANVASS_NETWORK_ERROR",posting:!1}),r=!1,this.commentFormStore.initialize(),i={slk:"fail"}),t.messageId!==o.messageId||!t.title||o.enhancedLink&&t.url===o.enhancedLink.url||(this.handleLinkUpdate(t,!1),this.context.getStore(b["default"]).initialize(),r=!1),e.handleCloseCommentForm&&r&&e.handleCloseCommentForm(),s&&i&&(0,m.fireRapidClick)(Object.assign({},s.getI13nNode().getMergedModel(),i))}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&"tumblrStickers"===this.state.activeTab&&this.setState({activeTab:null})}},{key:"toggleActiveTab",value:function(e){var t=this.state,n=t.activeTab!==e?e:null;this.setState({activeTab:n,enhancedLink:!1}),this.setCommentingState(!!n||t.validComment)}},{key:"enhanceLink",value:function(e){var t=this.props,n=this.state,a=t.configStoreState;if(!n.enhancedLinkRemoved&&!n.enhancedLink&&"tumblrStickers"!==n.activeTab){var s=(0,p.matchLinks)(e);s&&this.context.executeAction(C["default"],{url:s[0],messageId:t.messageId,lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret})}}},{key:"handleShowTumblrStickers",value:function(){(0,d.findDOMNode)(this.refs.commentText).focus(),this.toggleActiveTab("tumblrStickers")}},{key:"handleLinkUpdate",value:function(e,t){this.getCommentText()||(t=!1),this.setState({activeTab:e&&"linkPreview",enhancedLink:e,enhancedLinkRemoved:t})}},{key:"handleFocus",value:function(){this.commentFormStore.setActiveForm(this.props),this.setState({activeTab:this.state.activeTab,errorStatus:null,posting:!1})}},{key:"handleBlur",value:function(){var e=this.props;e.replyFormInFocus&&e.handleReplyFormBlur()}},{key:"setCommentingState",value:function(e,t){var n=this.context,a=this.props,s=this.state.commenting!==e;if(s&&this.setState({commenting:e}),t||s){var o=(0,f["default"])(n,["componentConfig","ui","presence","enabled"])||(0,f["default"])(n,["componentConfig","ui","presence","heartbeat"]),r=a.configStoreState.notificationInterval;o&&r&&(e&&!this.heartbeat&&(this.heartbeat=setInterval(this.handleHeartbeatInterval,1e3*r)),n.executeAction(T["default"],{context:n.context,eventType:e?"START_TYPING":"STOP_TYPING",messageId:a.messageId,namespace:a.messageNamespace||n.namespace}))}}},{key:"handleUserIdle",value:function(){this.setCommentingState(!1)}},{key:"handleHeartbeatInterval",value:function(){this.state.commenting&&("visible"===(document&&document.visibilityState||"visible")&&this.context.renderTarget.isActive()?this.setCommentingState(!0,!0):this.setCommentingState(!1))}},{key:"handleCommentChanged",value:function(e){this.props.configStoreState.notificationInterval&&e&&(clearTimeout(this.userIdleTimer),this.userIdleTimer=setInterval(this.handleUserIdle,6e4)),this.state.validComment!==e&&(this.setState({validComment:e}),this.setCommentingState(e))}},{key:"handlePaste",value:function(e){var t=(e.clipboardData||e.originalEvent.clipboardData||window.clipboardData).getData("text");this.handleCommentChanged(this.state.validComment||!!t),this.props.configStoreState.allowSmartlinks&&t&&this.enhanceLink(t)}},{key:"handleKeyUp",value:function(e){var t=this.props.configStoreState.allowSmartlinks,n=e.target.value.trim();n||t&&this.state.enhancedLinkRemoved&&this.setState({enhancedLinkRemoved:!1}),t&&32===e.keyCode&&this.enhanceLink(n),this.handleCommentChanged(!!n)}},{key:"handlePost",value:function(e,t){var n=this.context,a=this.props,s=(0,d.findDOMNode)(this.refs.commentText).value.trim(),o=this.state.enhancedLink,r=this.state.selectedUserLabel?[this.state.selectedUserLabel]:[];s||o||e?(this.setState({errorStatus:null,posting:!0}),this.context.executeAction(k["default"],{author:t,content:s,context:n.contextId||n.context,contextDisplayText:n.contextDisplayText,contextUrl:n.contextUrl,enhancedLink:o,forReply:a.forReply||!1,instanceId:n.instanceId,isUserMessageHistory:n.isUserMessageHistory,mentions:a.mentions,messageId:a.messageId,messageNamespace:a.messageNamespace||"",namespace:n.namespace,parentContextDisplayText:a.parentContextDisplayText||"",parentContextUrl:a.parentContextUrl||"",replyId:a.replyId,sticker:e,userLabels:r})):this.setState({errorStatus:"CANVASS_MISSING_COMMENT"})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.handlePost()}},{key:"handleLoginLink",value:function(){var e=this.context;e.executeAction(M["default"],{context:e.context,loginUrl:this.state.loginUrl})}},{key:"handleUserLabelSelection",value:function(e){this.setState({selectedUserLabel:e})}},{key:"renderErrorBox",value:function(){return this.state.errorStatus?i["default"].createElement("div",{className:"error-box C($c-fuji-red-2-b) Pstart(12px) Pb(10px)"},i["default"].createElement(R.Icon,{name:"attention",width:16,height:16,color:"#ff333c",className:"D(ib) Va(tb)! Mend(7px)"}),i["default"].createElement(w.FormattedMessage,{id:this.state.errorStatus})):null}},{key:"renderLoadingBox",value:function(){return this.state.posting?i["default"].createElement("div",{className:"H(100%) Bg(bgLoading) Op(0.7) C($c-fuji-grey-g) Bgz(35px) Pos(a) B(0) W(100%) Z(1)"}):null}},{key:"renderLoginPrompt",value:function(){var e=this.context,t=this.props;if(t.isFullScreen)return null;if(t.isReadOnly)return this.renderCommentsTitle();var n=t.deepLink,a=t.forReply,s="CANVASS_SIGN_IN"+("2"===e.session.dimensions.authed?"_AGAIN":""),o=a?s+"_POST_REPLY":s+"_POST_COMMENT",r=(0,c["default"])("Mb(15px)",{"Mt(18px)":a,"Mend(15px)":n&&!n.replyId});return i["default"].createElement("div",{className:r},this.renderCommentsTitle(),this.renderRelatedTags(),i["default"].createElement(m.I13nAnchor,{className:"comment-form D(ib) Bxz(bb) W(100%) P(6px) Bds(s) Bdw(1px) Bdc(#e2e2e2) Fz(13px) C($c-fuji-blue-1-a) O(n):h O(n):a",target:"_top",ref:"loginPrompt",follow:!1,href:this.state.loginUrl,onBlur:this.handleBlur,onClick:this.handleLoginLink,onFocus:this.handleFocus,i13nModel:(0,m.getI13nModel)("login",this.getI13nModel())},i["default"].createElement("span",{className:"label D(ib) Va(m) Fw(500) Pstart(8px)"},i["default"].createElement(w.FormattedMessage,{id:o}))))}},{key:"renderRelatedTags",value:function(){var e=this.props,t=this.state.enableRelatedTags;return t&&e.commentsExpanded&&!e.readOnly?i["default"].createElement(N["default"],{component:"div",transitionName:"action",transitionAppear:!0,transitionAppearTimeout:250,transitionEnterTimeout:250,transitionLeaveTimeout:250},i["default"].createElement(j["default"],{enableRelatedTags:t,handleRemoveRelatedTags:this.handleRemoveRelatedTags,relatedTags:e.relatedTags,selectedTags:e.selectedTags})):null}},{key:"handleRemoveRelatedTags",value:function(){this.canvassStore.resetRelatedTags(this.context.instanceId),this.setState({enableRelatedTags:!1}),this.context.handleOverlay(!1)}},{key:"handleRelatedTags",value:function(){var e=this.props,t=this.context,n=e.configStoreState;t.handleOverlay(!0),this.setState({enableRelatedTags:!0}),this.context.executeAction(E["default"],{context:t.context,instanceId:t.instanceId,lang:n.lang,namespace:t.namespace,oauthConsumerKey:n.oauthConsumerKey,oauthConsumerSecret:n.oauthConsumerSecret,region:n.region,tagsAnd:(0,p.joinFilterTags)(t.tagsAnd,e.selectedTags),tagsOr:t.tagsOr})}},{key:"handleTitleClick",value:function(){var e=this.props;e.enableTitleClick&&e.count>0&&e.onTitleClick&&e.onTitleClick()}},{key:"onTitleHover",value:function(){this.props.enableTitleClick&&this.props.count>0&&this.setState({titleHovered:!this.state.titleHovered})}},{key:"getHeading",value:function(){var e=this.props,t=e.count,n=this.context,a=n.intl,s=n.contextDisplayText,o=n.componentConfig.ui.showContextDisplayText,r=a.formatNumber(t),i="";if(e.commentsExpanded)switch(t){case 0:i=a.formatMessage({id:"CANVASS_BE_THE_FIRST"});break;case 1:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE_WITH_TITLE"},{title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE"});break;default:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE_WITH_TITLE"},{count:r,title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE"},{count:r})}else i=t?a.formatMessage({id:"CANVASS_VIEW_COMMENTS"},{count:r}):a.formatMessage({id:"CANVASS_BE_THE_FIRST"});return i}},{key:"renderHeading",value:function(){var e=this.props,t=this.state,n=e.enableTitleClick&&e.count>0,a=(0,c["default"])("comments-title D(ib) Td(n) Bd(0) P(0) Fw(b) Fz(16px)",{"Cur(p)":n,"C($c-fuji-blue-1-a)":t.titleHovered,"C(#000)":!t.titleHovered}),s=(0,m.getI13nModel)(e.commentsExpanded?"comments-open":"comments-close");return i["default"].createElement(m.I13nButton,{bindClickEvent:n,className:a,onClick:n?this.handleTitleClick:null,onMouseEnter:n?this.onTitleHover:null,onMouseLeave:n?this.onTitleHover:null,i13nModel:s},i["default"].createElement(R.Icon,{asset:O["default"],className:"comment-icon Mend(7px)",color:this.state.titleHovered?"#188fff":"#000",style:{verticalAlign:"middle"},height:21,width:21}),this.getHeading())}},{key:"renderCommentsTitle",value:function(){var e=this.props;if(e.forReply)return null;var t=e.configStoreState,n=e.isReadOnly,a=e.sentiments,s=t.enableSentiments&&a&&a.size?i["default"].createElement(L["default"],{className:"Fl(end) Fz(13px) Fw(n) Whs(nw) Pos(r) Cur(p) Z(1)",sentiments:a}):null;return i["default"].createElement("div",{className:(0,c["default"])("comment-heading Pend(6px) C(#000)",{"Py(15px)":!n,"Pt(15px)":n})},i["default"].createElement("div",{className:"D(ib)"},this.renderHeading(),t.enableRelatedTags&&e.commentsExpanded?i["default"].createElement(m.I13nButton,{type:"button",onClick:this.handleRelatedTags,className:"related-tags-add-btn Mstart(5px)! Cur(p) O(n):h O(n):a Va(t) P(0) M(0) Bd(n)"},i["default"].createElement(R.Icon,{name:"plus-circle",style:{verticalAlign:"middle"},width:15,height:15,color:"#188fff"})):null),s)}},{key:"renderActiveTab",value:function(){switch(this.state.activeTab){case"linkPreview":return i["default"].createElement(P["default"],{enhancedLink:this.state.enhancedLink,onLinkUpdate:this.handleLinkUpdate,fromStream:!1,isUserMessageHistory:this.context.isUserMessageHistory});case"tumblrStickers":return i["default"].createElement(B["default"],{onStickerClick:this.handlePost});default:return null}}},{key:"getI13nModel",value:function(){var e=this.props;return{cpos:e.forReply?e.cpos:null,reply_lv:e.replyId?2:e.forReply?1:0}}},{key:"renderUserLabels",value:function(){var e=(0,f["default"])(this.context,["componentConfig","ui","userLabels"])||{};if(e.enable){var t=this.props,n=t.forReply,s=t.isFullScreen,o=(0,c["default"])("Pos(r) Pt(5px) Pb(10px)",{"Px(2px)":s&&!n,"Pstart(16px)":!s&&!n,"Pstart(10px)":n});return i["default"].createElement(U["default"],a({className:o,handleSelection:this.handleUserLabelSelection,isReadOnly:!1,selectedValue:this.state.selectedUserLabel},e))}}},{key:"renderUploadOptions",value:function(){var e=this.state.activeTab,t=this.context,n=this.props,a=n.forReply,s=n.isFullScreen,o=n.configStoreState.allowAnimatedGIF,r="tumblrStickers"===e?"#188fff":"#878c91",u=l["default"].dedupe("Pos(r)",{"Px(2px)":s&&!a,"Pstart(16px) Pb(10px)":!s,"H(20px)":!o,"Pstart(10px)":a}),c="tumblrStickers"===e?{slk:"gif hide",outcm:"hide"}:{slk:"gif show",outcm:"show"};return i["default"].createElement("div",{className:u},o?i["default"].createElement(m.I13nButton,{"aria-label":t.intl.formatMessage({id:"CANVASS_SHOW_GIFS"}),className:"Va(m) O(n):h O(n):a P(0) M(0) Bd(n)",i13nModel:(0,m.getI13nModel)("tumblr-icon",c),onClick:this.handleShowTumblrStickers,type:"button"},i["default"].createElement(R.Icon,{name:"gif",height:23,color:r})):null)}},{key:"renderSubmitButton",value:function(){var e=this.props,t=e.forReply,n=e.isFullScreen,a=this.state,s=a.validComment,o=a.enhancedLink,r=o?{elmt:"link",elm:"cmmt_post"}:{elmt:"text",elm:"cmmt_post"},l=(0,c["default"])("comment-submit Fw(600) Bgc(t) Bd(n) O(n):h O(n):a M(0)",{"Pt(6px) Px(12px)":n,"P(12px)":!n,"Fz(14px)":t||n,"Fz(16px)":!t&&!n,"C($c-fuji-blue-1-a)":s||o,"C($c-fuji-grey-c)":!s&&!o}),u=i["default"].createElement(m.I13nButton,{bindClickEvent:!1,className:l,disabled:s||o?undefined:"disabled",i13nModel:(0,m.getI13nModel)(t?"reply-post":"comment-post",r),ref:"submit",type:"submit"},this.context.intl.formatMessage({id:t?"CANVASS_REPLY":"CANVASS_POST"}));return i["default"].createElement("div",{className:"Pos(a) End(0) B(0)"},this.renderGuidelinesLink(),u)}},{key:"renderGuidelinesLink",value:function(){var e=this.context,t=e.componentConfig&&e.componentConfig.guidelineUrl;if(t)return i["default"].createElement(m.I13nAnchor,{className:"C(#9ea2af) Fz(14px) Mend(5px)",href:t,i13nModel:(0,m.getI13nModel)("guidelines"),target:"_blank"},e.intl.formatMessage({id:"CANVASS_GUIDELINES"}))}},{key:"renderTextArea",value:function(){var e=this.props,t=e.configStoreState,n=e.deepLink,a=e.forReply,s=e.messageId,o=e.isFullScreen,r=e.value,u=t.allowAnimatedGIF,c=t.enableRelatedTags,d=t.allowSmartlinks,p=this.context.intl,m="smartphone"===(0,f["default"])(this.context,["session","dimensions","device"]),h=l["default"].dedupe("Bd(n) Fz(14px) Lh(20px) W(100%) Bxsh(n) C($c-fuji-grey-l)",{"P(2px)":o&&!a,"Pstart(16px) Py(12px)":!o,"Pstart(10px) Pt(10px)":a}),g=p.formatMessage({id:a?"CANVASS_POST_REPLY":u&&c&&d?m?"CANVASS_POST_COMMENT_SMARTPHONE_LONG":"CANVASS_POST_COMMENT_LONG":"CANVASS_POST_COMMENT"}),y=l["default"].dedupe("Pos(r) Ov(h) Bgc(#fff)",{"Mend(8px)":n,"My(13px) Bdc($c-fuji-grey-c) Bd Bdrs(2px)":!o,"Mt(8px) Mb(10px)":o,"Mstart(40px) Mt(16px) Mb(13px)":a,"Mstart(50px)":!a});return i["default"].createElement("div",{className:y},i["default"].createElement(F["default"],{ref:"commentText",className:h,key:"textarea-"+s,maxLength:5e3,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,placeholder:g,rows:1,value:r}),this.renderLoadingBox(),this.renderUserLabels(),this.renderActiveTab(),this.renderUploadOptions(),this.renderSubmitButton())}},{key:"renderForm",value:function(){var e=this.props,t=e.isFullScreen,n=e.isReadOnly,a=e.userProfile,s=l["default"].dedupe("Pos(r)",{"Mstart(20px) Mend(10px)":t}),o=i["default"].createElement(A.I13nDiv,{className:s,i13nModel:this.getI13nModel()},t?undefined:this.renderCommentsTitle(),t?undefined:this.renderRelatedTags(),n?undefined:i["default"].createElement(I["default"],{creator:e.guid,fromCommentForm:!0,imageUrl:a.imageUrl,isReply:e.forReply,key:"byline-commentform"+e.messageId,name:a.nickName}),n?undefined:i["default"].createElement("form",{className:"Ov(h) W(100%) Cf",encType:"multipart/form-data",onKeyDown:this.onKeyDown,onSubmit:this.handleSubmit,ref:"form"},this.renderTextArea(),this.renderErrorBox()));return t?i["default"].createElement("div",{className:"Pos(f) Bgc(#fff) Z(2) B(0) Start(0) End(0) BdT Bdc($c-fuji-grey-c)"},o):o}},{key:"render",value:function(){return this.props.isHidden?null:this.props.isSignedIn?this.renderForm():this.renderLoginPrompt()}}]),t}(r.PureComponent);H.contextTypes={componentConfig:o["default"].object.isRequired,configStoreState:o["default"].object.isRequired,context:o["default"].string,contextDisplayText:o["default"].string,contextId:o["default"].string,contextUrl:o["default"].string,executeAction:o["default"].func.isRequired,getStore:o["default"].func,handleOverlay:o["default"].func,handleResize:o["default"].func.isRequired,instanceId:o["default"].string,intl:o["default"].object.isRequired,isUserMessageHistory:o["default"].bool,namespace:o["default"].string,renderTarget:o["default"].object.isRequired,session:o["default"].object.isRequired,tags:o["default"].string,tagsAnd:o["default"].string,tagsOr:o["default"].string},H.defaultProps={commentsExpanded:!0},t["default"]=(0,g["default"])(H,[S["default"],b["default"],v["default"],x["default"]],(function(e,t){var n=e.getStore(S["default"]),a=e.getStore(v["default"]),s=a.isActiveForm(t),o=a.getActiveForm();return{guid:n.getGuid(),isActive:s,isHidden:!s&&t.forReply&&(o.messageId===t.messageId||t.replyId),isProfileLoaded:n.isLoaded(),isSignedIn:n.isSignedIn(),userProfile:n.getProfile(),enhancedLink:Object.assign({},e.getStore(b["default"]).getState()),commentForm:Object.assign({},a.getState()),configStoreState:Object.assign({},e.getStore(x["default"]).getState())}}))},2791:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(13);var o=(0,((a=s)&&a.__esModule?a:{"default":a})["default"])({storeName:"CanvassLinkEnhancerStore",statics:{handlers:{CANVASS_GET_ENHANCE_URL_SUCCESS:"canvassEnhancedLinkSuccess"}},initialize:function(){this.state={}},canvassEnhancedLinkSuccess:function(e){this.state=e.data,this.state.messageId=e.messageId,this.emitChange()},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}});t["default"]=o,e.exports=t["default"]},2792:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(1172)),s=r(n(1181)),o=n(1603);function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){var r=e.session.query,i=e.getStore(s["default"]).getState(),l=t.instanceId,u=t.oauthConsumerKey||i.oauthConsumerKey,c=t.oauthConsumerSecret||i.oauthConsumerSecret,d=t.namespace||r.namespace||i.namespace;if(!l||!c||!u)return n("Required fields missing",null);var f=e.getStore(a["default"]).getCommentsState(l),p=t.tagsAnd||f.tagsAnd||null,m=t.tagsOr||f.tagsOr||null,h=t.context||r.context||"YahooGlobal";if(f.get("relatedTags"))return n&&n();var g={apiVersion:i.apiVersion,context:h,cpNamespace:i.cpNamespace,count:t.count||10,lang:t.lang||i.lang||"en-US",namespace:d,region:t.region||i.region||"US",oauthConsumerKey:u,oauthConsumerSecret:c};g.query=(0,o.createSearchQuery)(p,m,h,d),e.service.read("canvass.getTrendingTags_ns",g,{},(function(t,a){return t||!a||a.error?n():(e.dispatch("CANVASS_GET_RELATED_TAGS_SUCCESS",{instanceId:l,relatedTags:a}),n())}))}i.displayName="loadRelatedTags",t["default"]=i,e.exports=t["default"]},2793:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=(c(n(4)),n(2)),o=c(s),r=c(n(1280)),i=n(1248),l=n(322),u=c(n(3388));function c(e){return e&&e.__esModule?e:{"default":e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.isReadOnly?d(a):((0,r["default"])(a,["handleSelection"]),a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"handleSelection",value:function(e){this.props.handleSelection&&this.props.handleSelection(e)}},{key:"getComponentProps",value:function(){var e=this.props,t={className:e.className};return e.isReadOnly||(t=Object.assign({},t,{i13nModel:(0,i.getI13nModel)("userlabels")})),t}},{key:"renderMessage",value:function(){var e=this.props;if(!(e.isReadOnly||!e.prompt||e.prompt.length<1))return o["default"].createElement("div",{className:"C($c-fuji-grey-g) Fz(14px) Pb(5px)"},e.prompt)}},{key:"renderUserLabels",value:function(){var e=this.props,t=e.labels;if(t){if(e.isReadOnly){var n=e.userLabels;if(!n||n.length<1)return;var a=Object.keys(t).reduce((function(e,a){return n.includes(a)&&(e[a]=t[a]),e}),{});return o["default"].createElement("div",{className:"D(ib) Pos(r)"},Object.keys(a).map((function(e,t){var n=a[e];if(n)return o["default"].createElement(u["default"],{config:n,key:e,value:e})})))}var s=e.selectedValue,r=this.handleSelection;return o["default"].createElement("div",{className:"D(ib) Pos(r)"},Object.keys(t).map((function(e,n){var a=t[e];if(a)return o["default"].createElement(u["default"],{config:a,handleSelection:r,isReadOnly:!1,isSelected:e===s,key:e,value:e})})))}}},{key:"render",value:function(){return this.props.enable?o["default"].createElement(l.I13nDiv,this.getComponentProps(),this.renderMessage(),this.renderUserLabels()):null}}]),t}(s.PureComponent);f.defaultProps={className:"",isReadOnly:!0,selectedValue:null},t["default"]=f,e.exports=t["default"]},2794:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=y(n(4)),o=n(2),r=y(o),i=y(n(1280)),l=y(n(1084)),u=n(1855),c=n(1248),d=y(n(1312)),f=y(n(1630)),p=y(n(2482)),m=y(n(329)),h=y(n(1160)),g=n(321);function y(e){return e&&e.__esModule?e:{"default":e}}var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,i["default"])(n,["handleClickOutside","handleFilterClick","handleKeyDown","handleShowMyComments","setSortMenu"]),n.state={menuOpen:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.sortBy!==e.sortBy})}},{key:"componentDidUpdate",value:function(e,t){var n=this;n.state.updating&&setTimeout((function(){n.setState({updating:!1})}),1e3),!t.menuOpen&&n.state.menuOpen&&n.sortMenu&&n.sortMenu.focus()}},{key:"handleClickOutside",value:function(){this.setState({menuOpen:!1})}},{key:"handleFilterClick",value:function(e){e&&e.stopPropagation(),this.setState({menuOpen:!this.state.menuOpen})}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&this.state.menuOpen&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleShowMyComments",value:function(){var e=this.props,t=e.currentUserProfile;this.context.handleUserMessages(e.currentUserGuid,t.imageUrl,t.nickName)}},{key:"handleSort",value:function(e,t){var n=this.context,a=this.props;if(a.sortBy!==e||t!==a.selectedTags){var s=n.instanceId,o=n.userMessageHistoryGuid,r=o?p["default"]:f["default"],i=void 0;i=o?{guid:o,name:a.userMessageHistoryName,image:a.userMessageHistoryImage,sortBy:e,instanceId:s}:{instanceId:s,sortBy:e,tagsAnd:n.tagsAnd,tagsOr:n.tagsOr,selectedTags:(t||[]).join(","),context:n.context,contextUrl:n.contextUrl,contextDisplayText:n.contextDisplayText},this.context.executeAction(r,i)}}},{key:"getSortLabel",value:function(e){var t=void 0;switch(e){case u.SORT_HIGHEST_RATED:t="CANVASS_SORT_HIGHEST_RATED";break;case u.SORT_LATEST:t="CANVASS_SORT_NEWEST";break;case u.SORT_NEWEST:t="CANVASS_SORT_RECENT";break;case u.SORT_OLDEST:t="CANVASS_SORT_OLDEST";break;case u.SORT_MOST_REPLIED:t="CANVASS_SORT_MOST_REPLIED";break;default:return null}return r["default"].createElement("span",null,this.context.intl.formatMessage({id:t}))}},{key:"getI13nOverride",value:function(e){return{slk:e}}},{key:"setSortMenu",value:function(e){this.sortMenu=e}},{key:"renderSortOptions",value:function(){if(this.state.menuOpen)return r["default"].createElement("ul",{"aria-label":this.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sorting-tabs Pos(a) Z(1) Bd Bdc($c-fuji-grey-c) Bdrs(3px) Bgc(#fff) Bxsh(boxShadow) Mt(8px) O(n)",ref:this.setSortMenu,role:"menu",tabIndex:"-1"},this.props.arrangement.map(this.renderSortOption,this))}},{key:"renderSortOption",value:function(e){var t=e===this.props.sortBy,n=this.getSortLabel(e);if(!n)return null;var a=(0,l["default"])("H(44px)",{selected:t});return r["default"].createElement("li",{className:a,key:e},r["default"].createElement(c.I13nButton,{className:"sort-by-"+e+" Px(16px) Py(12px) O(n):h O(n):a Cur(p) C($c-fuji-grey-g) Fz(14px) Fw(500) C($c-fuji-blue-1-a):h selected_C($c-fuji-blue-1-a) selected_Fw(b) W(100%) Ta(start)",onClick:this.handleSort.bind(this,e,this.props.selectedTags),role:"menuitem",i13nModel:(0,c.getI13nModel)("sort",this.getI13nOverride(e))},n))}},{key:"handleClickSelectedTag",value:function(e){var t=this.props,n=t.selectedTags,a=n===undefined?[]:n,s=t.sortBy;a=a.filter((function(t){return t!==e})),this.handleSort(s,a)}},{key:"renderSelectedTags",value:function(){var e=this.props,t=e.selectedTags,n=e.selectedTagsCount,a=t&&t.size;if(a>0)return r["default"].createElement("div",{className:"D(ib)"},t.map((function(e,t){return r["default"].createElement(c.I13nButton,{className:"Fz(12px) Fw(500) Lh(1) P(4px) Pstart(8px) Bdrs(4px) Mend(8px) C(#fff) Bgc($c-fuji-blue-1-a)",i13nModel:{elm:"cmmt_tag",pos:a-1,slk:e},key:"tag-"+t,onClick:this.handleClickSelectedTag.bind(this,e)},"#"+e,r["default"].createElement("span",{className:"Fw(n) D(ib) Mx(4px)"},"("+this.context.intl.formatNumber(n)+")"),r["default"].createElement(g.Icon,{asset:m["default"],color:"#fff",height:14,style:{verticalAlign:"text-bottom"},width:14}))}),this))}},{key:"renderMyCommentsButton",value:function(){var e=this.context,t=this.props;if(t.myComments&&t.currentUserGuid&&t.currentUserProfile&&!e.isUserMessageHistory)return r["default"].createElement(c.I13nButton,{className:"my-comments-button O(n) Fz(14px) Fw(600) C($c-fuji-grey-l) M(0) P(0) Fl(end)",i13nModel:(0,c.getI13nModel)("user-comments-tap",{guid:t.guid}),onClick:this.handleShowMyComments},e.intl.formatMessage({id:"CANVASS_MY_COMMENTS"}))}},{key:"render",value:function(){var e=this.props,t=e.sortBy,n=this.state.updating;return e.count<2||Object.keys(e.arrangement).length<2?null:r["default"].createElement("div",{className:"sorting-tabs-container Pos(r) Mt(5px)",onClick:this.handleClickOutside,onKeyDown:this.handleKeyDown},r["default"].createElement(c.I13nButton,{"aria-expanded":this.state.menuOpen?"true":undefined,"aria-haspopup":"true","aria-label":this.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sort-filter-button O(n):h O(n):a Fz(14px) Fw(600) M(0) P(0) Trsdu(.5s) Trsp(color) "+(n?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-l)"),i13nModel:(0,c.getI13nModel)("sort-btn",this.getI13nOverride(t)),onClick:this.handleFilterClick},this.getSortLabel(t),r["default"].createElement(g.Icon,{asset:h["default"],className:"Mstart(5px) Mend(13px) Trsdu(.5s)",color:n?"#5601ec":"#26282a",width:10,height:10,style:{verticalAlign:"middle"}})),this.renderSortOptions(),this.renderSelectedTags(),this.renderMyCommentsButton())}}]),t}(o.PureComponent);v.contextTypes={configStoreState:s["default"].object.isRequired,context:s["default"].string,contextDisplayText:s["default"].string,contextUrl:s["default"].string,executeAction:s["default"].func,handleUserMessages:s["default"].func,instanceId:s["default"].string,intl:s["default"].object,isUserMessageHistory:s["default"].bool,tags:s["default"].string,tagsAnd:s["default"].string,tagsOr:s["default"].string,userMessageHistoryGuid:s["default"].string},v.defaultProps={arrangement:[],count:0,sortBy:"popular"},t["default"]=(0,d["default"])(v),e.exports=t["default"]},3368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=W(n(4)),r=n(2),i=W(r),l=W(n(1664)),u=W(n(2249)),c=W(n(1280)),d=W(n(1084)),f=n(34),p=n(1248),m=W(n(1)),h=W(n(182)),g=W(n(1312)),y=n(63),v=W(n(58)),x=W(n(123)),b=W(n(1597)),S=W(n(1911)),C=W(n(1630)),_=W(n(2682)),E=W(n(3369)),M=W(n(2482)),k=W(n(2483)),T=W(n(3370)),I=W(n(183)),O=W(n(1172)),N=W(n(2250)),w=W(n(1181)),A=W(n(1136)),R=W(n(2783)),P=W(n(3371)),j=W(n(2484)),L=W(n(2790)),F=W(n(1636)),B=n(85),U=n(322),D=n(321),H=W(n(2794)),V=W(n(3390)),z=W(n(3392)),G=n(1855);function W(e){return e&&e.__esModule?e:{"default":e}}var $="undefined"!=typeof document?document:null,K="undefined"!=typeof window?window:null,q=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=n;return(0,c["default"])(a,["handleContainerScroll","handleClick","handleMessage","handleOverlay","handleRefresh","handleRemoveUserComments","handleResize","handleShowMessages","handleToggleComments","handleUserMessages","handleWindowScroll"]),a.state={loadingNextComments:!1,overlay:!1,pollingEnabled:!1,userHistoryTop:"0px"},a.hasEnoughHeight=!0,a.isDwellActive=!1,a.isFullScreen=(0,m["default"])(e,["componentConfig","ui","isFullScreen"]),a.isIframe=K&&K!==K.parent,a.isIframeInViewport=a.isIframe&&a.isFullScreen,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"getChildContext",value:function(){var e=this.props;return{componentConfig:e.componentConfig,configStoreState:e.configStoreState,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,guid:e.guid,instanceId:e.instanceId,namespace:e.namespace,tags:e.tags,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,theme:e.theme,themeContainerClasses:e.themeContainerClasses,handleUserMessages:this.handleUserMessages,handleOverlay:this.handleOverlay,handleResize:this.handleResize}}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"componentDidMount",value:function(){var e=this.context,t=this.props,n=(0,f.findDOMNode)(this.refs.canvass),a=t.componentConfig.ui||{};if(this.setupRapidInstance(),this.setupPolling(t.configStoreState.pollingInterval),this.scrollHandler=(0,v["default"])("scroll",this.handleWindowScroll,{enableScrollInfo:!0}),n&&a.scrollPagination&&(this.scrollContainer=this.isFullScreen?n.querySelector("#comments-fullscreen"):K,this.scrollContainer&&this.scrollContainer.addEventListener("scroll",(0,x["default"])(this.handleContainerScroll,50))),t.deepLink&&e.renderTarget.isActive()){if(n){var s=t.componentConfig.FIXED_UH_HEIGHT||0,o=$.documentElement;(0,l["default"])((o&&o.scrollTop||$.body.scrollTop||0)+n.getBoundingClientRect().top-s-50)}this.handleShowMessages("showExpanded")}K.addEventListener("message",this.handleMessage),this.handleResize(),this.setPollingState(t),this.setDwellState(!!t.expandForRoute||this.isFullScreen)}},{key:"componentWillUnmount",value:function(){this.scrollHandler&&this.scrollHandler.unsubscribe(),this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.handleContainerScroll),K.removeEventListener("message",this.handleMessage),this.setDwellState(!1),this.setupPolling(0),this.destroyRapidInstance(),this.context.getStore(O["default"]).resetUserComments()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props;e.expanded===n.expanded&&e.messages===n.messages||this.handleResize(),e.expanded!==n.expanded&&this.setDwellState(n.expanded)}},{key:"setupRapidInstance",value:function(){if(this.isFullScreen){var e=y.RapidManager&&y.RapidManager.getRapidInstance();if(e){if(e.addModuleAPV){var t=K.rapidListeners||{};K.rapidListeners=t,this.destroyRapidInstance(),t.canvassAPV=e.addModuleAPV("comments-fullscreen")}e.beaconAPV&&e.beaconAPV()}}}},{key:"destroyRapidInstance",value:function(){var e=(0,m["default"])(K.rapidListeners,["canvassAPV"]);e&&"function"==typeof e.destroy&&(e.destroy(),delete K.rapidListeners.canvassAPV)}},{key:"handleContainerScroll",value:function(){var e=this.props,t=this.scrollContainer;if(e.expanded&&e.showLoadNext&&!this.state.loadingNextComments){var n=this.refs.shownextbutton,a=(0,f.findDOMNode)(n);if(a){var s=t.innerHeight||t.clientHeight;a.getBoundingClientRect().top<s+G.SCROLL_BUFFER&&(this.handleShowMessages("showNext"),(0,p.fireRapidClick)(Object.assign({},n.getI13nNode().getMergedModel(),{elmt:"scroll"})))}}}},{key:"handleWindowScroll",value:function(e,t){this.setPollingState(this.props,t)}},{key:"handleClick",value:function(){this.setDwellState(this.props.expanded)}},{key:"handleClickOutside",value:function(){!this.isIframe&&this.isDwellActive&&this.setDwellState(!1)}},{key:"setDwellState",value:function(e){this.context.renderTarget.isActive()&&e!==this.isDwellActive&&!this.isIframe&&(this.isDwellActive=e,this.context.executeAction(T["default"],{context:this.props.context,pct:e?"comments":""}))}},{key:"getUserHistoryTop",value:function(e){var t=0,n=e.userComments.get("guid"),a=(0,f.findDOMNode)(this.refs.canvass);if(!n||!a||!a.getBoundingClientRect)return"0px";if(this.isFullScreen)return Math.max(Math.floor((K.innerHeight-G.USER_HISTORY_HEIGHT)/2)-4,G.COMMUNITY_BAR_HEIGHT)+"px";var s=a.getBoundingClientRect(),o=e.componentConfig.FIXED_UH_HEIGHT||0,r=Math.max(o,s.top),i=K.innerHeight-r;this.hasEnoughHeight=s.height>=G.USER_HISTORY_HEIGHT;var l=s.top<=0?Math.abs(s.top)+o:s.top<=o?o-s.top:0;if(i<G.USER_HISTORY_HEIGHT)t=l;else if(this.hasEnoughHeight){(t=K.parent!==K&&this.userHistoryClickPos?Math.max(o,this.userHistoryClickPos-G.USER_HISTORY_HEIGHT/3):l+parseInt(i/2-G.USER_HISTORY_HEIGHT/2,10))+G.USER_HISTORY_HEIGHT>s.height&&(t=s.height-G.USER_HISTORY_HEIGHT-100)}else t=0;return t+5+"px"}},{key:"componentWillReceiveProps",value:function(e){var t=e.context,n=e.tags,a=e.count;if(!this.loadEventFired&&(n||t)){var s=this.context.i13n.getI13nNode().getMergedModel();s.cat=n||"",s.context=t,s.slk="canvass-load",s.t1="a3",s.t2="results",s.t3=a,(0,p.fireRapidEvent)("secvw",s),this.loadEventFired=!0}this.setState({loadingNextComments:!1,userHistoryTop:e.userComments?this.getUserHistoryTop(e):"0px"});var o=e.configStoreState.pollingInterval;this.props.configStoreState.pollingInterval!==o&&(this.setupPolling(o),this.setPollingState(e)),this.props.expanded!==e.expanded&&this.setPollingState(e)}},{key:"setupPolling",value:function(e){var t=this.timer;t&&(clearInterval(t),this.timer=null),e>0&&!this.props.disabled&&(this.timer=setInterval(this.handleRefresh,1e3*e))}},{key:"setPollingState",value:function(e,t){var n=(0,f.findDOMNode)(this.refs.canvass);if(n&&e.expanded&&!e.isReadOnly&&void 0!==K&&this.context.renderTarget.isActive()){var a=!1;if(this.isIframe)a=this.isIframeInViewport;else{var s=t&&t.resize&&t.resize.height||K.innerHeight,o=n.getBoundingClientRect();a=!(o.top>s+20||o.bottom<-20)}e.configStoreState.pollingInterval>0&&this.state.pollingEnabled!==a&&(this.setState({pollingEnabled:a}),a&&(t||this.isIframe)&&this.handleRefresh()),!a&&this.isDwellActive&&this.setDwellState(!1)}else this.setState({pollingEnabled:!1})}},{key:"handleMessage",value:function(e){if(e&&e.data&&e.source!==K&&this.refs.canvass){var t=e.data,n=this.props.expanded,a=this.refs.canvass.getI13nNode().getMergedModel();n||"canvass:expand"!==t?n&&"canvass:collapse"===t?(this.handleShowMessages("showCollapsed"),(0,p.fireRapidClick)(Object.assign({},a,(0,p.getI13nModel)("comments-close")))):"canvass:enterViewport"===t?(this.isIframeInViewport=!0,this.setPollingState(this.props)):"canvass:exitViewport"===t&&(this.isIframeInViewport=!1,this.setPollingState(this.props)):(this.handleShowMessages("showExpanded"),(0,p.fireRapidClick)(Object.assign({},a,(0,p.getI13nModel)("comments-open"))))}}},{key:"handleOverlay",value:function(e){this.setState({overlay:e})}},{key:"handleRefresh",value:function(){var e=this.props,t=e.instanceId,n=e.namespace,a=e.selectedTags;if(this.state.pollingEnabled&&"visible"===($&&$.visibilityState||"visible")&&(0,f.findDOMNode)(this.refs.canvass)){var s=(0,m["default"])(e,["componentConfig","ui"])||{},o=s.sortTabs||{},r=void 0;-1!==(o.polling||o.arrangement||[]).indexOf(e.sortBy)?r=_["default"]:s.presence&&s.presence.readingUsersCount&&(r=E["default"]),r&&this.context.executeAction(r,{context:e.context,instanceId:t,namespace:n,refresh:!0,selectedTags:a&&a.size?a.join(","):"",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}}},{key:"handleResize",value:function(){var e=this.props;e.handleResize&&this.context.executeAction(k["default"],{context:e.context,count:e.count,isExpanded:e.expanded})}},{key:"handleShowMessages",value:function(e){var t=this.props,n=t.selectedTags,a=C["default"],s={context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,instanceId:t.instanceId,namespace:t.namespace,selectedTags:n&&n.size?n.join(","):"",sortBy:t.sortBy,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr};"showNext"===e?(this.setState({loadingNextComments:!0}),s.nextIndex=t.nextIndex,s.showNextClicked=!0):"showNew"===e?(s.showNewClicked=!0,s.sortBy="createdAt"):"showExpanded"===e?(s.expanded=!0,a=b["default"]):"showCollapsed"!==e||(0,m["default"])(t,["componentConfig","ui","isFullScreen"])||(s.expanded=!1,a=b["default"]),this.context.executeAction(a,s)}},{key:"handleUserMessages",value:function(e,t,n,a){this.context.executeAction(M["default"],{guid:e,image:t,name:n,sortBy:"createdAt",instanceId:this.props.instanceId}),a&&(this.userHistoryClickPos=a.clientY,this.userHistoryClickTarget=a.currentTarget)}},{key:"handleRemoveUserComments",value:function(){this.handleOverlay(!1),this.context.getStore(O["default"]).resetUserComments(),this.userHistoryClickTarget&&(this.userHistoryClickTarget.focus(),this.userHistoryClickTarget=null,this.userHistoryClickPos=0)}},{key:"handleToggleComments",value:function(){this.handleShowMessages(this.props.expanded?"showCollapsed":"showExpanded")}},{key:"renderShowNewMessagesButton",value:function(){var e=this,t=this.props,n=t.newMessagesCount,a=this.state.loadingNextComments;if(n&&t.expanded)return i["default"].createElement(p.I13nButton,{ref:"shownewbutton",i13nModel:(0,p.getI13nModel)("comments-showNew"),onClick:function(){return e.handleShowMessages("showNew")},className:(0,d["default"])(u["default"].get("btn btn-secondary btn-spacing btn-sm-fullwidth","D(b) Mx(a) Pos(r) Mb(0)"),{"B(70px)":this.isFullScreen&&!this.enableUserLabels,"B(120px)":this.isFullScreen&&this.enableUserLabels})},!a&&n?"("+n+") ":"",i["default"].createElement(B.FormattedMessage,{id:a?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_NEW_COMMENTS"}))}},{key:"renderShowNextButton",value:function(){var e=this,t=this.props;if(t.showLoadNext&&t.expanded)return i["default"].createElement(p.I13nButton,{ref:"shownextbutton",i13nModel:(0,p.getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:(0,d["default"])(u["default"].get("btn btn-secondary btn-spacing btn-sm-fullwidth","showNext D(b) Mx(a) Pos(r)"),{"B(70px)":this.isFullScreen&&!this.enableUserLabels,"B(120px)":this.isFullScreen&&this.enableUserLabels})},i["default"].createElement(B.FormattedMessage,{id:this.state.loadingNextComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"}))}},{key:"renderActivityIndicator",value:function(){var e=this.props,t=(0,m["default"])(e,["componentConfig","ui","presence","enabled"]);if(e.expanded&&t){var n=e.context,a=(0,m["default"])(e,["commentingState",n],!1);return i["default"].createElement(P["default"],{key:n,commenting:a,userActivity:e.userActivity})}}},{key:"renderUserCount",value:function(){var e=this.props,t=e.deepLink,n=e.userActivity;if((0,m["default"])(e,["componentConfig","ui","presence","readingUsersCount"])&&e.count&&e.expanded&&n)return i["default"].createElement(z["default"],{className:t&&t.replyId?"Mt(20px) D(n)--maw350":"Mt(5px)",count:n.get("readingUsersCount",0)})}},{key:"renderUserComments",value:function(){var e=this.props,t=e.userComments,n=e.instanceId;if(t.get("guid")&&t.get("instanceId")===n)return i["default"].createElement(F["default"],{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:300,transitionEnterTimeout:300,transitionLeaveTimeout:300},i["default"].createElement(V["default"],{handleRemoveUserComments:this.handleRemoveUserComments,isFullScreen:this.isFullScreen,key:"userComments-"+t.get("guid"),top:this.state.userHistoryTop,userComments:t}))}},{key:"renderDisclaimer",value:function(e){var t=e.text;if(e.enable&&t&&t.length)return i["default"].createElement("div",{className:"canvass-disclaimer Bd Bdc(#d8dade) P(10px) Mt(10px)"},i["default"].createElement(D.Icon,{className:"Mend(6px) Fl(start)",color:"#f00",height:20,name:"attention",width:20}),t.map((function(e,t){return i["default"].createElement("p",{className:"Mb(6px) Fz(14px) Fw(200)",dangerouslySetInnerHTML:{__html:e},key:t})})))}},{key:"render",value:function(){var e=this.isFullScreen,t=this.props,n=t.componentConfig,s=t.configStoreState,o=t.context,r=t.contextDisplayText,l=t.contextUrl,u=t.count,c=t.deepLink,f=t.selectedTags,h=t.sortBy,g=t.theme,y=t.themeContainerClasses,v=this.state.overlay,x=n.isReadOnly,b=!(!c||!c.replyId);if(t.disabled||x&&0===u||!this.context.renderTarget.isActive())return null;var S=t.messages?t.messages.toJS():[],C=n.ui||{},_=(0,m["default"])(C,["userLabels","enable"]),E=void 0,M=void 0,k=void 0,T=void 0,I=void 0;u>0&&(t.expanded||c)&&(c&&c.message&&!b&&(k=i["default"].createElement(j["default"],{className:"Mstart(-12px) My(15px)",deepLink:c,isReadOnly:x,itemClassName:"P(12px)",list:[c.message],parentContextDisplayText:r,parentContextUrl:l,replySortBy:t.replySortBy,sortBy:h})),b?E=i["default"].createElement(p.I13nButton,{className:"C($c-fuji-blue-1-a) Fz(16px) Fw(b) Mt(16px)",onClick:this.handleShowMessages},i["default"].createElement(D.Icon,{className:"Fl(start) Mstart(-15px) Mend(2px)",color:"#188fff",height:22,name:"caret-left",style:{strokeWidth:1},width:22}),i["default"].createElement(B.FormattedMessage,{id:"CANVASS_VIEW_ALL_COMMENTS",values:{count:u}})):!x&&S.length>0&&(E=i["default"].createElement(H["default"],a({},C.sortTabs,{count:u,currentUserGuid:t.guid,currentUserProfile:t.userProfile,key:"sorting-tabs",ref:"sortingtabs",selectedTags:f,selectedTagsCount:t.selectedTagsCount,sortBy:h}))),M=i["default"].createElement(j["default"],{className:(0,d["default"])({"Mstart(-8px)":x,"Mstart(-12px) Pt(5px)":!x,"Pb(70px)":e&&!_,"Pb(120px)":e&&_}),isReadOnly:x,itemClassName:x?"Mt(10px) P(8px)":"Mt(5px) P(12px)",list:S,ref:"commentlist",parentContextDisplayText:r,parentContextUrl:l,replySortBy:t.replySortBy,sortBy:h}));var O=void 0;b||(O=i["default"].createElement(L["default"],{commentsExpanded:t.expanded,count:u,enableTitleClick:!C.expanded||C.enableCommentsToggle,isFullScreen:e,isReadOnly:x,onTitleClick:this.handleToggleComments,ref:"commentform",relatedTags:t.relatedTags,selectedTags:t.selectedTags,sentiments:t.sentiments})),o&&!x&&(T=this.renderShowNewMessagesButton(),I=this.renderShowNextButton());var N,w,A,R={cat:t.tags||"",cnv_bkt:s.rankingProfile||s.scoreAlgo,g:o,tags:f.join(",")},P="redesign"===g;return i["default"].createElement(U.I13nDiv,{"aria-label":this.context.intl.formatMessage({id:"CANVASS_COMMENTS"}),className:(0,d["default"])(t.className,C.containerExtraClasses,(N={},w=y,A=P&&y,w in N?Object.defineProperty(N,w,{value:A,enumerable:!0,configurable:!0,writable:!0}):N[w]=A,N)),i13nModel:R,id:t.instanceId,onClick:this.handleClick,ref:"canvass",tabIndex:"-1"},e?O:null,i["default"].createElement("div",{id:e?"comments-fullscreen":undefined,className:(0,d["default"])("comments-body",{"Pos(f) T(0) B(0) Start(0) End(0) Px(20px) Z(1) Pt(70px)":e,"Ov(s) Ovs(touch)":e&&!v,"Ov(h)":e&&v})},v?i["default"].createElement("div",{className:"StretchedBox Bgc(#fff) Op(0.7) Z(2)"}):null,e?null:O,this.renderDisclaimer(C.disclaimer),this.renderUserComments(),k,this.renderUserCount(),E,this.renderActivityIndicator(),T,M,I))}}]),t}(r.PureComponent);q.defaultProps={className:"tdv2-applet-canvass Lh(1.55em) M(a) smartphone_Px(10px) Pb(25px) Pos(r) O(n)",configStoreState:{},expanded:!0,handleResize:!0},q.contextTypes={executeAction:o["default"].func,getStore:o["default"].func,i13n:o["default"].object,intl:o["default"].object,renderTarget:o["default"].object.isRequired,session:o["default"].object},q.childContextTypes={componentConfig:o["default"].object.isRequired,configStoreState:o["default"].object.isRequired,context:o["default"].string,contextDisplayText:o["default"].string,contextUrl:o["default"].string,guid:o["default"].string,handleOverlay:o["default"].func,handleResize:o["default"].func,handleUserMessages:o["default"].func,instanceId:o["default"].string,namespace:o["default"].string,session:o["default"].object,tags:o["default"].string,tagsAnd:o["default"].string,tagsOr:o["default"].string,theme:o["default"].string,themeContainerClasses:o["default"].string};var Y=(0,g["default"])(q);Y.initializeAction=S["default"],Y.componentConfig={name:"componentComments"},t["default"]=(0,I["default"])(Y,[O["default"],N["default"],w["default"],A["default"],R["default"]],(function(e,t){var n=t.instanceId||t.id,a=e.getStore(O["default"]).getCommentsState(n),s=e.getStore(O["default"]).getUserCommentsState(),o=e.getStore(A["default"]),r=e.getStore(N["default"]).getState(),i=e.getStore(w["default"]).getState(),l=a.get("deepLink"),u=e.getStore(R["default"]).getSentiments(n),c=(0,m["default"])(t,["componentConfig","ui"],{}),d=a.get("disabled"),f=a.get("sortBy"),p="",g=0,y="",v=a.get("messageList"),x=i.topReplySort&&"popular"===f?"popular":"createdAt",b=a.get("showLoadNext"),S=a.get("theme"),C=a.get("themeContainerClasses");return(t.context||(0,m["default"])(e,["session","query","context"],""))===a.get("context")&&(p=a.get("context"),g=a.get("count"),y=a.get("contextDisplayText")),l&&l.get("replyId")&&(v=h["default"].List([l.get("message")]),x="createdAt",b=!1),{commentingState:r.commenting,configStoreState:i,context:p,contextDisplayText:y,contextUrl:a.get("contextUrl"),count:g,deepLink:l?l.toJS():null,disabled:d,expanded:!d&&a.get("expanded",(0,m["default"])(c,["expanded"],!0)),guid:o.getGuid(),messages:v,namespace:t.namespace||a.get("namespace")||i.namespace,newMessagesCount:a.get("newMessagesCount"),nextIndex:a.get("nextIndex"),instanceId:n,relatedTags:a.get("relatedTags"),replySortBy:x,selectedTags:a.get("selectedTags"),selectedTagsCount:a.get("selectedTagsCount"),sentiments:u,showLoadNext:b,sortBy:f,tags:a.get("tags"),tagsAnd:a.get("tagsAnd"),tagsOr:a.get("tagsOr"),theme:S,themeContainerClasses:C,userActivity:a.get("userActivity"),userComments:s,userProfile:o.getProfile()}}),{session:o["default"].object.isRequired}),e.exports=t["default"]},3369:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(1172)),s=o(n(1181));function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o=t.instanceId,r=e.getStore(s["default"]).getState();if(!o||!r.oauthConsumerSecret||!r.oauthConsumerKey)return n("Required fields missing",null);var i=e.getStore(a["default"]).getCommentsState(o),l={apiVersion:r.apiVersion,context:t.context||"YahooGlobal",cpNamespace:r.cpNamespace,lang:r.lang,region:r.region,namespace:t.namespace||i.get("namespace")||r.namespace,oauthConsumerKey:r.oauthConsumerKey,oauthConsumerSecret:r.oauthConsumerSecret};e.service.read("canvass.getPresence_ns",l,{},(function(t,a){if(t||!a)return e.dispatch("CANVASS_PRESENCE_FAILURE",{instanceId:o}),n&&n(t,null);e.dispatch("CANVASS_PRESENCE_SUCCESS",{instanceId:o,userActivity:a}),n&&n()}))}r.displayName="loadUserActivity",t["default"]=r,e.exports=t["default"]},3370:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var r=e.getStore(s["default"]),i=r&&r.getI13nConfig()||{},l=(0,a["default"])(i.rapid,["dwell_on"]),u=t.pct||(0,a["default"])(i.rapid,["keys","pct"]),c=t.context,d=o.RapidManager&&o.RapidManager.getRapidInstance();d&&l?d.beaconClick("rapidDwell","",0,{g:c},"",(function(){d.setRapidAttribute({keys:{pct:u}}),d.beaconClick("rapidDwell","",0,{g:c},"",null,{dwell:"start"}),n&&n()}),{dwell:"stop"}):n&&n()};var a=r(n(1)),s=r(n(42)),o=n(63);function r(e){return e&&e.__esModule?e:{"default":e}}e.exports=t["default"]},3371:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=u(n(4)),o=n(2),r=u(o),i=u(n(2251)),l=u(n(1636));function u(e){return e&&e.__esModule?e:{"default":e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=e.userActivity&&e.userActivity.get("typingUsersCount")||0;return n.state={typingUsersCount:a},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.state.typingUsersCount>0&&this.context.handleResize()}},{key:"componentDidUpdate",value:function(e,t){var n=t.typingUsersCount,a=this.state.typingUsersCount;n!==a&&(n<=0||a<=0)&&this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=e.userActivity&&e.userActivity.get("typingUsersCount")||0,n=this.state.typingUsersCount;this.props.commenting!==e.commenting&&(t=e.commenting?n+1:n-1),this.setState({typingUsersCount:t})}},{key:"render",value:function(){var e=this.state.typingUsersCount;return e<=0?null:r["default"].createElement(i["default"],null,r["default"].createElement(l["default"],{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:0,transitionEnterTimeout:0,transitionLeaveTimeout:300},r["default"].createElement("div",{className:"Mt(24px) Pb(12px) H(0) BdT Bdc($c-fuji-grey-c) Ta(c)"},r["default"].createElement("span",{className:"Bgc($c-fuji-grey-b) H(24px) Px(10px) Py(0) Pos(r) T(-14px) Bd Bdc($c-fuji-grey-c) Bdrs(5px) D(ib)"},r["default"].createElement("span",{className:"C($c-fuji-grey-l) Fz(12px) Fw(500) D(ib) Lh(20px) Va(tt)"},this.context.intl.formatMessage({id:"CANVASS_USERS_COMMENTING"},{count:e})),r["default"].createElement("img",{alt:"",className:"Va(m) Mstart(5px)",src:"https://s.yimg.com/dh/ap/default/161130/loading_dots.gif",width:"30",height:"10"})))))}}]),t}(o.PureComponent);c.contextTypes={handleResize:s["default"].func.isRequired,intl:s["default"].object.isRequired},c.defaultProps={commenting:!1},t["default"]=c,e.exports=t["default"]},3372:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=T(n(4)),r=n(2),i=T(r),l=T(n(2100)),u=T(n(1084)),c=n(322),d=n(1248),f=T(n(1)),p=T(n(1280)),m=T(n(3373)),h=n(1603),g=T(n(3374)),y=T(n(2787)),v=T(n(2251)),x=T(n(1636)),b=n(85),S=n(321),C=n(1090),_=T(n(2789)),E=T(n(3377)),M=T(n(3378)),k=T(n(2793));function T(e){return e&&e.__esModule?e:{"default":e}}var I=(0,c.createI13nNode)("li",{isLeafNode:!0}),O=new RegExp("(\r\n|\r|\n)|"+m["default"].URLPATTERN+"|"+m["default"].PSEUDOURLPATTERN,"gim"),N=/(\r\n|\r|\n)/g,w=/(\r\n|\r|\n){3,}/g,A=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,p["default"])(a,["handleFeedbackMessage","handleImageLoad","handleMessageClick","handleToggleReplies"]);var s=n.guid,o=e.data.meta,r=o===undefined?{}:o,i=s&&s===(0,f["default"])(r,["author","guid"])&&Date.now()/1e3-r.createdAt<=5;return a.state={actionType:null,animClass:i?"Bgc(#fff8e4)":"",imageLoaded:!1,isNew:i,showFeedbackMessage:!1,showReplies:!1,visible:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"getChildContext",value:function(){var e=this.props;return{contextId:e.contextId,cpos:e.cpos,pos:e.pos}}},{key:"componentDidMount",value:function(){this.setState({animClass:""})}},{key:"componentWillUnmount",value:function(){clearTimeout(this._timer)}},{key:"shouldComponentUpdate",value:function(e,t){return!(0,h.shallowEqual)(this.state,t)||!(0,h.shallowEqual)(this.props.data,e.data,["vote","contextId","messageId","replyId"])}},{key:"getI13nModel",value:function(){var e=this.props,t=e.data,n=e.pos,a=t.replyId,s={elm:"cmmt_seen",msg_id:a||t.messageId,slk:"seen",cpos:e.cpos,pos:null!==n?n:"",reply_lv:a?1:0};return this.context.isUserMessageHistory&&(s.g=this.props.contextId),s}},{key:"renderContextInfo",value:function(){var e=this.context,t=this.props,n=(0,f["default"])(t.data,["meta","contextInfo"])||{},a=n.displayText||"",s=n.url||"",o="context-info My(8px) Fz(12px) Fw(b) Lh(14px)";if((e.isUserMessageHistory||e.context!==t.contextId)&&null===t.pos&&a)return s?i["default"].createElement(d.I13nAnchor,{className:o+" D(ib) Td(n) C($c-fuji-blue-1-a)",href:s,i13nModel:(0,d.getI13nModel)("context-link"),rel:"noopener noreferrer",target:"_blank"},a):i["default"].createElement("div",{className:o+" C($c-fuji-grey-l)"},a)}},{key:"parseMessageForLinks",value:function(){var e=this.props,t=e.isReadOnly,n=e.data.details.userText;if(n){var a=n.replace(w,"\n\n"),s=void 0,o=[],r="",l={index:0,0:""};for(O.lastIndex=0;null!==(s=O.exec(a));)(r=a.slice(l.index+l[0].length,s.index)).length&&o.push(r),s[0].indexOf(".")>0?o.push(i["default"].createElement(d.I13nAnchor,{className:"C($c-fuji-blue-1-a) Td(n)",href:-1===s[0].indexOf("://")?"http://"+s[0].trim():s[0],i13nModel:(0,d.getI13nModel)("link"),key:o.length,rel:"noopener noreferrer nofollow",target:"_blank"},s[0])):o.push(i["default"].createElement("br",{key:o.length})),l=s;o.push(o.length?a.slice(l.index+l[0].length):a);var c=(0,u["default"])("C($c-fuji-grey-l) Mb(2px) Fz(14px) Lh(20px) Pend(8px)",{"LineClamp(3,66px)":t});return i["default"].createElement("div",{className:c},o)}}},{key:"renderVideo",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.video;return i["default"].createElement(_["default"],{enhancedLink:{url:a?a.url:"",title:n.title,description:n.description,image:{url:a.coverImage?a.coverImage.url:""}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"handleImageLoad",value:function(){this.setState({imageLoaded:!0})}},{key:"renderImage",value:function(e){if(e&&0!==e.length){var t=(0,f["default"])(e,[0,"image","resolutions"],[]),n=(0,f["default"])(e,[0,"attribution","name"],"");n=n?(0,h.trimDescription)(n,30):"";var a=void 0;if(t&&0!==t.length){a=t[0];for(var s=t.length-1;s>=0;s--)if(t[s].width<=375){a=t[s];break}}else a=(0,f["default"])(e,[0,"image"]);if(a){return i["default"].createElement("div",{className:"Pos(r) D(ib) Lh(12px)"},i["default"].createElement(C.Img,{key:a.url,className:"W(a) Mah(320px) My(3px) H(a) Maw(100%)",url:a.url,onLoadCallback:this.handleImageLoad,forceLoad:!0,alt:"Image"+n,height:a.height,width:a.width}),(this.state.imageLoaded||this.context.isUserMessageHistory)&&n?i["default"].createElement("div",{className:"W(100%) Ta(end) Op(0.6) Bg(gradient) Fz(9px) Fw(b) C($c-fuji-grey-c) Pos(a) End(0) B(3px) Lh(8px) Py(4px)"},i["default"].createElement("div",{className:"D(ib) Op(1)"},i["default"].createElement(b.FormattedMessage,{id:"CANVASS_ATTRIBUTION",values:{author:n,source:i["default"].createElement("img",{className:"W(a) Mend(5px) Mstart(2px) Va(bl)",src:"https://s.yimg.com/dh/ap/default/160620/tumblr-logo-transparent-1x.png"})}}))):undefined)}}}},{key:"renderSmartLink",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.coverImages;return i["default"].createElement(_["default"],{enhancedLink:{url:n.url,title:n.title,description:n.description,image:{url:a&&a[0].url}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"shouldEnableSeeMore",value:function(e,t){if(this.props.isReadOnly||!e.enable||!t)return!1;var n=t.userText||"";return n.length>e.maxTextLength||(n.match(N)||[]).length>=e.lines}},{key:"handleMessageClick",value:function(e){if(!e.target.getAttribute("href")){var t=this.props.data;if(this.context.isUserMessageHistory){var n=((0,f["default"])(t,["meta","contextInfo"])||{}).url;if(n)n+=(-1===n.indexOf("?")?"?":"&")+"messageId="+t.messageId,t.replyId&&(n+="&replyId="+t.replyId),window.open(n+"&bcmt=1","_blank").opener=null,(0,d.fireRapidClick)(Object.assign(this.context.i13n.getI13nNode().getMergedModel(),this.getI13nModel(),{elm:"cmmt_body",slk:"deeplink",itc:0}))}else{if((0,f["default"])(this.context,["componentConfig","ui","enableRepliesToggle"])&&window.getSelection().toString().length<1){var a=!this.state.showReplies;this.setState({showReplies:a}),(0,d.fireRapidClick)(Object.assign(this.context.i13n.getI13nNode().getMergedModel(),this.getI13nModel("comment-replies"),{slk:a?"show replies":"hide replies"}))}}}}},{key:"renderMessage",value:function(){var e=this.props,t=e.data,n=e.seeMore,a=n===undefined?{}:n,s=this.context,o=s.isUserMessageHistory,r=s.componentConfig,l=(0,f["default"])(t,["details"],{}),u=(0,f["default"])(r,["ui","enableRepliesToggle"])&&(0,f["default"])(t,["reactionStats","replyCount"])>0||o&&!!(0,f["default"])(t,["meta","contextInfo","url"]),c=this.parseMessageForLinks(),d=this.shouldEnableSeeMore(a,l);return i["default"].createElement("div",{className:"Wow(bw)"+(u?" Cur(p)":""),onClick:this.handleMessageClick},d?i["default"].createElement(E["default"],{isUserMessageHistory:o,lines:a.lines,lineHeight:a.lineHeight},c):c,this.renderVideo(l.videoMessageDetails)||this.renderSmartLink(l.linkMessageDetails)||this.renderImage(l.imageMessageDetails))}},{key:"handleToggleReplies",value:function(e){this.setState({showReplies:e})}},{key:"renderUserLabels",value:function(){var e=this.context,t=(0,f["default"])(this.props.data,["userLabels"],[]),n=(0,f["default"])(e,["componentConfig","ui","userLabels"],{});if(n.enable&&!(t.length<1)){return i["default"].createElement(k["default"],a({className:"Py(4px)",userLabels:t},n))}}},{key:"renderActionForm",value:function(){var e=this.props,t=e.data,n=t.meta.author;if(!e.isReadOnly)return i["default"].createElement(v["default"],null,i["default"].createElement(g["default"],{creator:n.guid,handleFeedbackMessage:this.handleFeedbackMessage,isReadOnly:e.isReadOnly,isUserMessageHistory:this.context.isUserMessageHistory,messageId:t.messageId,messageNamespace:e.messageNamespace,nickname:n.nickname,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl,replyId:t.replyId}))}},{key:"renderSocialControl",value:function(){var e=this.props;if(!e.isReadOnly){var t=this.context,n=e.data,a=n.meta.author,s=(0,f["default"])(t,["componentConfig","ui","enableRepliesToggle"])&&(0,f["default"])(n,["reactionStats","replyCount"])>0;return i["default"].createElement(M["default"],{author:a,instanceId:t.instanceId,isUserMessageHistory:t.isUserMessageHistory,key:"social-"+(n.replyId||n.messageId),messageId:n.messageId,messageNamespace:e.messageNamespace,onRepliesToggle:s?this.handleToggleReplies:null,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl,parentTags:e.parentTags||[],reactionStats:n.reactionStats,replyCount:n.reactionStats.replyCount,replyId:n.replyId,replySortBy:e.replySortBy,showReplies:!!s&&this.state.showReplies,sortBy:e.sortBy,userReportedAbuse:n.abuseReason,vote:(n.vote||"").toLowerCase()})}}},{key:"handleFeedbackMessage",value:function(e){this.setFeedbackTimer(),this.setState({showFeedbackMessage:!0,actionType:e,visible:!0})}},{key:"setFeedbackTimer",value:function(){null!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){this.setState({visible:!1}),this._timer=null}.bind(this),2e3)}},{key:"renderFeedbackMessage",value:function(){if(this.state.visible){var e="delete"===this.state.actionType?"CANVASS_DELETED_MESSAGE":"flag"===this.state.actionType?"CANVASS_FLAGGED_MESSAGE":"CANVASS_MUTED_MESSAGE";return i["default"].createElement("div",{className:"Pos(a) Start(0) Bxz(bb) W(100%) Bxsh(boxShadow) Py(6px) Px(8px) Fz(13px) C(#000) Bgc($c-fuji-grey-b)"},i["default"].createElement(S.Icon,{name:this.state.actionType,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21}),i["default"].createElement(b.FormattedMessage,{id:e}))}}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.pos,s=this.state,o=s.isNew,r=s.showFeedbackMessage,u=t.messageId,c=t.replyId;if(!t.details)return null;var d=t.meta,f=d.createdAt,p=d.author,m=t.lastActivity&&t.lastActivity.activityAt||0,h=p&&p.image?p.image.url:"",g=this.getI13nModel(),v=l["default"].dedupe("comment Pend(2px) "+e.className,this.state.animClass,{"Trsde(3s) Trsdu(.5s)":o&&!r,"Mb(40px)":r,"P(0)! M(0)!":r&&!this.state.visible}),b=l["default"].dedupe("Pos(r) Pstart(52px)",{"Pstart(40px)":null!==n}),S=o?x["default"]:I,C=void 0;o&&(C={component:I,transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1});var _="comment"+(c||u);return r?i["default"].createElement(x["default"],{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:1e3},i["default"].createElement("li",{key:"feedback"+this.state.visible,className:v},this.renderFeedbackMessage())):i["default"].createElement(S,a({key:_,className:v,i13nModel:g},C),i["default"].createElement("div",{className:b},i["default"].createElement(y["default"],{activityAt:1e3*m,createdAt:1e3*f,creator:p.guid,imageUrl:h,isReadOnly:e.isReadOnly,key:"byline-"+(c||u),messageId:t.messageId,name:p.nickname,pos:n,replyCount:t.reactionStats.replyCount,replyId:t.replyId,sortBy:e.sortBy}),this.renderContextInfo(),this.renderMessage(),this.renderUserLabels(),this.renderActionForm(),this.renderSocialControl()))}}]),t}(r.Component);A.contextTypes={componentConfig:o["default"].object,configStoreState:o["default"].object.isRequired,context:o["default"].string,contextDisplayText:o["default"].string,contextUrl:o["default"].string,executeAction:o["default"].func.isRequired,guid:o["default"].string,i13n:o["default"].object.isRequired,instanceId:o["default"].string,intl:o["default"].object,isUserMessageHistory:o["default"].bool,session:o["default"].object,userMessageHistoryGuid:o["default"].string},A.childContextTypes={contextId:o["default"].string,cpos:o["default"].number,pos:o["default"].number},A.defaultProps={className:"",contextId:null,cpos:null,data:{},pos:null,sortBy:""},t["default"]=A,e.exports=t["default"]},3373:function(e,t){e.exports=Object.freeze({URLPATTERN:"\\b(?:https?|ftp)://[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]",PSEUDOURLPATTERN:"(^|[^/])(www\\.[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|])",MENTIONS:"(://|>)?(@([_a-z0-9-]+))",HASHTAGS:"(://[^ <]*|>)?(#([_a-z0-9-]+))"})},3374:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=b(n(4)),o=n(2),r=b(o),i=b(n(2249)),l=b(n(1280)),u=n(34),c=b(n(1)),d=n(1248),f=b(n(1312)),p=b(n(3375)),m=b(n(3376)),h=b(n(2784)),g=n(85),y=n(321),v=b(n(2785)),x=b(n(2786));function b(e){return e&&e.__esModule?e:{"default":e}}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,l["default"])(n,["closeFlyout","handleAction","handleClickOutside","handleRadioChanged","handleReport","handleToggleFlyout","handleToggleToolTip","openFlyout"]),n.state={selectedAbuseOption:"",flyoutOpened:!1,reportOpened:!1,showTooltip:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.props.messageId!==e.messageId&&this.setState({flyoutOpened:!1,reportOpened:!1,selectedAbuseOption:"",showTooltip:!1})}},{key:"componentDidUpdate",value:function(e,t){!t.flyoutOpened&&this.state.flyoutOpened&&this.refs.flyout.focus()}},{key:"handleRadioChanged",value:function(e){this.setState({selectedAbuseOption:e.currentTarget.value})}},{key:"handleReport",value:function(){var e=this.context,t=this.props,n=e.intl.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),a=this.state.selectedAbuseOption===n?(0,u.findDOMNode)(this.refs.reportText).value.trim():this.state.selectedAbuseOption;a?(e.executeAction(h["default"],{abuseReason:a,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,voteType:"abuse"}),t.handleFeedbackMessage("flag")):this.setState({reportOpened:!1})}},{key:"handleDelete",value:function(){var e=this.context,t=this.props;e.executeAction(m["default"],{context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId})}},{key:"handleBlockUser",value:function(){var e=this.context,t=this.props;e.executeAction(p["default"],{blockedGuid:t.creator,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,userId:e.guid})}},{key:"handleClickOutside",value:function(e){this.closeFlyout()}},{key:"openFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"closeFlyout",value:function(){this.setState({flyoutOpened:!1,reportOpened:!1,showTooltip:!1})}},{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened,showTooltip:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showTooltip:!this.state.showTooltip})}},{key:"handleAction",value:function(e){if(this.context.guid){var t=this.props,n="undefined"!=typeof t.delay?t.delay:2500;"flag"!==e&&(t.handleFeedbackMessage(e),setTimeout(function(){"delete"===e?this.handleDelete():"block"===e&&this.handleBlockUser()}.bind(this),n)),this.setState({flyoutOpened:!1,reportOpened:"flag"===e&&!this.state.reportOpened})}else this.setState({showTooltip:!0})}},{key:"renderFlyoutButton",value:function(e){var t="Pos(r) W(100%) H(a) Mih(36px) Z(1) Pend(14px) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) Cur(p) Py(6px) Pstart(8px) Fz(13px) C($c-fuji-grey-l) Bgc(#fff) Bgc($c-fuji-grey-b):h flyout-button-"+e,n="D(ib) Ta(start) Wow(bw) Pstart(28px) "+("delete"===e?"W(100px)":"W(125px)"),a=this.context.intl,s=void 0;switch(e){case"delete":s=a.formatMessage({id:"CANVASS_DELETE_MESSAGE"});break;case"flag":s=a.formatMessage({id:"CANVASS_FLAG_MESSAGE"});break;case"block":s=a.formatMessage({id:"CANVASS_MUTE_MESSAGE"},{user:this.props.nickname})}return r["default"].createElement(d.I13nButton,{onClick:this.handleAction.bind(this,e),i13nModel:(0,d.getI13nModel)("comment-"+e),role:"menuitem",className:t},r["default"].createElement("div",{className:"W(40px) D(ib) Pos(a) T(6px) Start(4px)"},r["default"].createElement(y.Icon,{name:e,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21})),r["default"].createElement("div",{className:n},s))}},{key:"renderFlyout",value:function(){if(!this.state.flyoutOpened)return null;var e=this.props.creator===this.context.guid;return r["default"].createElement("div",{tabIndex:"-1",role:"menu",ref:"flyout",className:"flyout O(n) Pos(a) T(0) End(25px) W(190px)"},this.renderFlyoutButton(e?"delete":"flag"),!e&&this.renderFlyoutButton("block"),this.renderTooltip())}},{key:"renderTooltip",value:function(){if(this.state.showTooltip)return r["default"].createElement(x["default"],{className:"Bxsh(boxShadowFlag) Bxz(bb) W(100%)",handleToggleToolTip:this.handleToggleToolTip,messageId:this.props.messageId,replyId:this.props.replyId})}},{key:"renderFlagOption",value:function(e,t){var n=this.props.replyId||this.props.messageId,a="report-option-"+n+"-"+t,s=this.context.intl.formatMessage({id:e});return r["default"].createElement("div",{className:"Mb(10px) flag-opts"},r["default"].createElement("input",{id:a,onChange:this.handleRadioChanged,type:"radio",name:"options-"+n,className:"Mend(10px) Va(t)",value:s}),r["default"].createElement("label",{htmlFor:a},s))}},{key:"renderOverflowButton",value:function(){var e=this.context,t=this.state.flyoutOpened?"#188fff":"#878c91",n="desktop"===(0,c["default"])(e,["session","dimensions","device"]);return r["default"].createElement("span",{className:"Pos(a) End(0) T(-3px)",onMouseEnter:n?this.openFlyout:null,onMouseLeave:n?this.closeFlyout:null},this.renderFlyout(),r["default"].createElement(d.I13nButton,{className:"O(n):h O(n):a Bd(n) Px(6px) Py(2px)","aria-expanded":this.state.flyoutOpened?"true":undefined,"aria-haspopup":"true","aria-label":e.intl.formatMessage({id:"CANVASS_SEE_MORE"}),onClick:this.handleToggleFlyout,i13nModel:(0,d.getI13nModel)("options")},r["default"].createElement(y.Icon,{name:"overflow",color:t,width:16,height:16})))}},{key:"renderReportForm",value:function(){if(!this.state.reportOpened)return null;var e=this.context,t=e.intl,n=t.formatMessage({id:"CANVASS_REPORT_REASON"}),a=t.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),s={outcm:"close"},o="desktop"===(0,c["default"])(e,["session","dimensions","device"]),l=i["default"].dedupe("D(n) P(6px) W(100%) H(33px) Fz(13px) Lh(12px) Mb(10px) Pstart(10px)",{"D(b)":this.state.selectedAbuseOption===a,"Fz(16px)":!o}),u="P(6px) W(30%) H(33px) Mend(10px) Mt(5px)";return r["default"].createElement("div",{className:"Pos(a) End(35px) T(-3px) P(14px) Fz(13px) Lh(16px) C(#000) Z(2) Bgc(#fff) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadow) report-form-container"},r["default"].createElement("div",{className:"Mb(10px) Fw(b)"},r["default"].createElement(g.FormattedMessage,{id:"CANVASS_REPORT_LABEL"})),r["default"].createElement("div",{className:"Row"},this.renderFlagOption("CANVASS_FLAG_REASON_INAPPROPRIATE_POST",1),this.renderFlagOption("CANVASS_FLAG_REASON_DOES_NOT_BELONG_HERE",2),this.renderFlagOption("CANVASS_FLAG_REASON_SPAM",3),this.renderFlagOption("CANVASS_FLAG_REASON_COPYRIGHT_VIOLATION",4),this.renderFlagOption("CANVASS_FLAG_REASON_ELSE",5),r["default"].createElement(v["default"],{ref:"reportText",rows:5,tabIndex:"1",className:l,placeholder:n}),r["default"].createElement(d.I13nButton,{type:"button",className:i["default"].get("btn btn-secondary",u),onClick:this.handleAction.bind(this,"flag"),i13nModel:(0,d.getI13nModel)("comment-report-cancel",s)},r["default"].createElement(g.FormattedMessage,{id:"CANVASS_CANCEL"})),r["default"].createElement(d.I13nButton,{type:"button",className:i["default"].get("btn btn-primary",u),onClick:this.handleReport,i13nModel:(0,d.getI13nModel)("comment-report-done",Object.assign({slk:this.state.selectedAbuseOption},s))},r["default"].createElement(g.FormattedMessage,{id:"CANVASS_DONE"}))))}},{key:"render",value:function(){return r["default"].createElement("div",null,this.renderOverflowButton(),this.renderReportForm())}}]),t}(o.PureComponent);S.contextTypes={componentConfig:s["default"].object.isRequired,configStoreState:s["default"].object.isRequired,contextId:s["default"].string,cpos:s["default"].number,getStore:s["default"].func.isRequired,guid:s["default"].string,instanceId:s["default"].string,intl:s["default"].object.isRequired,isUserMessageHistory:s["default"].bool,executeAction:s["default"].func.isRequired,pos:s["default"].number,session:s["default"].object.isRequired,tags:s["default"].string,userMessageHistoryGuid:s["default"].string},t["default"]=(0,f["default"])(S),e.exports=t["default"]},3375:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var a=e.getStore(o["default"]).getState(),s=Object.assign({apiVersion:a.apiVersion,cpNamespace:a.cpNamespace,lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},t);e.service.create("canvass.blockUser",s,{},(function(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_BLOCK_FAILURE",t),n();e.dispatch("CANVASS_BLOCK_SUCCESS",s),n()}))};var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};e.exports=t["default"]},3376:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var a=t.replyId?"canvass.deleteReply_ns":"canvass.deleteMessage_ns",s=e.getStore(o["default"]).getState(),r=Object.assign({apiVersion:s.apiVersion,cpNamespace:s.cpNamespace,lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t);e.service["delete"](a,r,{},(function(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_DELETE_FAILURE",t),n();e.dispatch("CANVASS_DELETE_SUCCESS",r),n()}))};var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};e.exports=t["default"]},3377:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=p(n(4)),o=n(2),r=p(o),i=p(n(1280)),l=n(1248),u=p(n(1160)),c=p(n(1607)),d=n(85),f=n(321);function p(e){return e&&e.__esModule?e:{"default":e}}var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,i["default"])(n,["getWrapperStyles","handleClick"]),n.state={expanded:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"handleClick",value:function(e){e&&e.stopPropagation(),this.setState({expanded:!this.state.expanded})}},{key:"getWrapperStyles",value:function(){return{maxHeight:this.state.expanded?null:this.props.lines*this.props.lineHeight,overflow:"hidden"}}},{key:"componentDidUpdate",value:function(e,t){t.expanded!==this.state.expanded&&this.context.handleResize()}},{key:"render",value:function(){var e=this.props,t=e.children,n=this.state.expanded,a=n?"CANVASS_SEE_LESS":"CANVASS_SEE_MORE",s=(0,l.getI13nModel)("comment-seemore",{sec:e.isUserMessageHistory?"cmmt_his":"cmmts"});return r["default"].createElement("div",{className:"canvass-see-more"},r["default"].createElement("div",{className:"see-more-wrapper",style:this.getWrapperStyles()},t),r["default"].createElement(l.I13nButton,{"aria-hidden":"true",className:"more-button Fz(13px) Fw(b) P(0) Mt(3px) Mb(6px) Bd(0) C($c-fuji-grey-l) O(n):h O(n):a",i13nModel:s,onClick:this.handleClick},r["default"].createElement(d.FormattedMessage,{id:a,className:"more-button-label"}),r["default"].createElement(f.Icon,{asset:n?c["default"]:u["default"],className:"Mstart(5px)",color:"#26282a",style:{verticalAlign:"middle"},width:9,height:9})))}}]),t}(o.Component);m.contextTypes={handleResize:s["default"].func.isRequired},m.defaultProps={lines:3,lineHeight:20},t["default"]=m,e.exports=t["default"]},3378:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=M(n(4)),r=n(2),i=M(r),l=M(n(1280)),u=M(n(1084)),c=M(n(1)),d=n(1248),f=M(n(1630)),p=M(n(3379)),m=M(n(183)),h=M(n(1172)),g=M(n(2250)),y=M(n(1136)),v=M(n(2790)),x=M(n(2484)),b=n(321),S=M(n(2788)),C=M(n(3389)),_=M(n(2786)),E=n(1855);function M(e){return e&&e.__esModule?e:{"default":e}}var k=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,l["default"])(a,["getReplies","handleCloseCommentForm","handleRepliesClick","handleReplyClick","handleReplyFormBlur","handleToggleToolTip","handleViewTopClick"]);var s=!(!e.deepLink||!e.deepLink.replyId),o=(0,c["default"])(n.componentConfig,["ui","replyPreview"]),r=(0,c["default"])(n.componentConfig,["ui","enableRepliesToggle"])&&e.showReplies;return a.state={loadingNextComments:!1,loadingPrevComments:!1,replyFormInFocus:!1,showReplyForm:r||s,showReplyList:r||s||o&&e.list.length>0},r&&a.getReplies("replies"),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"getReplies",value:function(e){var t=this.context,n=this.props,a=n.replyListState.nextIndex,s=!0,o=n.replySortBy;"showNext"===e?this.setState({loadingNextComments:!0}):"showPrev"===e?(o="createdAtDesc",a=n.replyListState.prevIndex,this.setState({loadingPrevComments:!0})):n.replyCount>0&&0===n.list.length?(e="showNext",this.setState({loadingNextComments:!0})):s=!1,s&&t.executeAction(p["default"],{action:e,context:t.contextId,count:10,index:a,instanceId:t.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:n.messageId,namespace:n.messageNamespace,sortBy:o,tags:t.tags})}},{key:"handleCloseCommentForm",value:function(){this.setState({replyFormInFocus:!1,showReplyForm:!1})}},{key:"handleRepliesClick",value:function(){var e=!this.state.showReplyList;this.getReplies("replies"),this.setState({openedBy:"replies",replyFormInFocus:!1,showReplyForm:e,showReplyList:e}),this.props.onRepliesToggle&&this.props.onRepliesToggle(e)}},{key:"handleReplyClick",value:function(){var e=this.state,t="reply"!==e.openedBy||!e.showReplyForm;t&&this.context.getStore(g["default"]).setActiveForm(this.props),this.setState({openedBy:"reply",replyFormInFocus:t,showReplyForm:t,showReplyList:!!t&&e.showReplyList})}},{key:"handleReplyFormBlur",value:function(){this.setState({replyFormInFocus:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showToolTip:!this.state.showToolTip})}},{key:"handleViewTopClick",value:function(){var e=this.context;e.executeAction(f["default"],{instanceId:e.instanceId,context:e.contextId,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,selectedTags:"",sortBy:"popular",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}},{key:"renderReplyButton",value:function(){var e=this.state,t=this.props.replyCount,n=this.context.intl,a="reply"!==e.openedBy||!e.showReplyForm,s=!e.showReplyList,o="O(n):h O(n):a P(0) Bd(n) Cur(p) Fz(12px) Fw(500) C($c-fuji-grey-g) D(ib) Mend(20px)";return i["default"].createElement("div",{className:"D(ib)"},i["default"].createElement(d.I13nButton,{bindClickEvent:a,className:"reply-button "+o,i13nModel:(0,d.getI13nModel)("reply"),key:a?"show-reply":"hide-reply",onClick:this.handleReplyClick},i["default"].createElement(b.Icon,{asset:S["default"],color:"#878c91",height:15,className:"Mend(5px)"}),n.formatMessage({id:"CANVASS_REPLY"})),t>0?i["default"].createElement(d.I13nButton,{bindClickEvent:s,className:"replies-button "+o,i13nModel:(0,d.getI13nModel)("replies-show"),key:s?"show-replies":"hide-replies",onClick:this.handleRepliesClick},n.formatMessage({id:"CANVASS_REPLIES"})+" ("+n.formatNumber(t)+")"):undefined)}},{key:"renderLoadingMessage",value:function(e){return i["default"].createElement("div",{className:"loading-msg Fz(14px) Fw(b) Lh(n) C($c-fuji-grey-g) D(ib) "+e},this.context.intl.formatMessage({id:"CANVASS_LOADING_MORE_COMMENTS"}))}},{key:"renderShowNextButton",value:function(e){var t=this,n=t.props,a=t.state;if(a.showReplyList)return a.loadingNextComments?t.renderLoadingMessage(e):n.replyListState.showLoadNext?i["default"].createElement(d.I13nButton,{i13nModel:(0,d.getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showNext")},className:"show-next-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},t.context.intl.formatMessage({id:"popular"===n.replySortBy?"CANVASS_SHOW_MORE_REPLIES":"CANVASS_SHOW_OLDER_REPLIES"})):void 0}},{key:"renderShowPrevButton",value:function(e){var t=this;if(this.state.showReplyList)return this.state.loadingPrevComments?this.renderLoadingMessage(e):this.props.replyListState.prevIndex?i["default"].createElement(d.I13nButton,{i13nModel:(0,d.getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showPrev")},className:"show-prev-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},this.context.intl.formatMessage({id:"CANVASS_SHOW_NEWER_REPLIES"})):void 0}},{key:"renderReplyBox",value:function(){var e=this.state;if(e.showReplyForm||e.showReplyList)return i["default"].createElement("div",{className:"reply-box"},this.renderCommentForm(),this.renderShowPrevButton("My(10px)"),this.renderCommentList(),this.renderShowNextButton("Mt(10px) Mb(5px) Mstart(40px)"))}},{key:"renderCommentForm",value:function(){if(this.state.showReplyForm){var e=this.props,t=e.author,n=t===undefined?{}:t,a=e.replyId,s=n.nickname;return i["default"].createElement(v["default"],{cpos:this.context.cpos,deepLink:e.deepLink,forReply:!0,handleCloseCommentForm:this.handleCloseCommentForm,handleReplyFormBlur:this.handleReplyFormBlur,mentions:a&&s?[{guid:n.guid,nickname:s}]:null,messageId:e.messageId,messageNamespace:e.messageNamespace||null,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl,parentTags:e.parentTags||[],replyFormInFocus:this.state.replyFormInFocus,replyId:a,value:a&&s?"@"+s+" ":""})}}},{key:"renderCommentList",value:function(){var e=this.props,t=this.state;if(t.showReplyList){var n=(0,u["default"])("Mstart(-10px)",{"Pt(10px)":!t.showReplyForm});return i["default"].createElement(x["default"],{className:n,cpos:this.context.cpos,deepLink:e.deepLink,itemClassName:"Py(10px) Pstart(10px)",key:"commentlist3",list:e.list,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl})}}},{key:"getThumbProps",value:function(e){var t=this.props,n={contextId:this.context.contextId,isSignedIn:t.isSignedIn,messageId:t.messageId,messageNamespace:t.messageNamespace,onToggleToolTip:this.handleToggleToolTip,reactionStats:t.reactionStats,replyId:t.replyId,thumbName:e,vote:t.vote,voteType:e},a=e&&E.THUMB_PROPS[e];return a&&delete(n=Object.assign({selectedColor:a.color,selectedIcon:a.icon},n,a)).color,n}},{key:"renderThumbs",value:function(){var e=this,t=e.props,n=(0,c["default"])(e.context,["componentConfig","ui","thumbs"],["up"]),s=n.length;return i["default"].createElement("div",{className:"D(ib) Pos(r)"},n.map((function(t,n){var o=(0,u["default"])("O(n):h O(n):a  Bgc(t) Bdc(t) M(0) P(0) Bd(n)",{"Mend(12px)":n<s-1});return i["default"].createElement(C["default"],a({},e.getThumbProps(t),{className:o,key:t,showCount:s>1}))})),e.state.showToolTip?i["default"].createElement(_["default"],{handleToggleToolTip:e.handleToggleToolTip,messageId:t.messageId,replyId:t.replyId}):undefined)}},{key:"componentDidUpdate",value:function(e,t){var n=this.state;(e.list||[]).length===(this.props.list||[]).length&&t.showReplyForm===n.showReplyForm&&t.showReplyList===n.showReplyList||this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=this.state,a={};if(e.messageId!==t.messageId||e.replyId!==t.replyId||e.showReplies!==t.showReplies||e.sortBy!==t.sortBy||!e.deepLink&&t.deepLink){var s=(0,c["default"])(context.componentConfig,["ui","replyPreview"]);a={loadingPrevComments:!1,loadingNextComments:!1,replyFormInFocus:!1,showReplyForm:e.showReplies,showReplyList:e.showReplies||s&&e.list.length>0},e.showReplies&&this.getReplies("replies")}else n.loadingNextComments&&e.replyListState.nextIndex!==t.replyListState.nextIndex&&(a.loadingNextComments=!1),n.loadingPrevComments&&e.replyListState.prevIndex!==t.replyListState.prevIndex&&(a.loadingPrevComments=!1);this.setState(a)}},{key:"render",value:function(){return i["default"].createElement("div",{className:this.props.className},this.renderReplyButton(),this.renderThumbs(),this.renderReplyBox())}}]),t}(r.PureComponent);k.contextTypes={componentConfig:o["default"].object,configStoreState:o["default"].object.isRequired,contextId:o["default"].string,contextUrl:o["default"].string,contextDisplayText:o["default"].string,cpos:o["default"].number,executeAction:o["default"].func.isRequired,getStore:o["default"].func.isRequired,handleResize:o["default"].func.isRequired,instanceId:o["default"].string,intl:o["default"].object,isUserMessageHistory:o["default"].bool,oauthConsumerKey:o["default"].string,oauthConsumerSecret:o["default"].string,pos:o["default"].number,tags:o["default"].string,userMessageHistoryGuid:o["default"].string},k.defaultProps={className:"Pos(r) Pt(5px)",list:[],replyListState:{},replySortBy:"createdAt"},t["default"]=(0,m["default"])(k,[y["default"],h["default"]],(function(e,t){var n=e.getStore(y["default"]),a=e.getStore(h["default"]),s=n.getGuid(),o=t.messageId,r=t.instanceId,i=t.isUserMessageHistory,l=t.replyId,u=l?null:a.getCommentsState(r).get("deepLink"),c=[],d={};return l||(c=a.getReplyList(o,r,i).toJS(),d=a.getReplyListState(o,r,i).toJS()),{deepLink:u&&u.get("messageId")===o?u.toJS():undefined,guid:s,isSignedIn:n.isSignedIn(),list:c,replyListState:d}})),e.exports=t["default"]},3379:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};function r(e,t,n){var a=t.action||"showNext",s=t.isUserMessageHistory,r=t.instanceId,i=t.sortBy,l=e.getStore(o["default"]).getState(),u=Object.assign({apiVersion:l.apiVersion,cpNamespace:l.cpNamespace,lang:l.lang,region:l.region,namespace:l.namespace,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);delete u.isUserMessageHistory,delete u.instanceId,e.service.read("canvass.getReplies_ns",u,{},(function(t,o){if(t||!o||o.error)return e.dispatch("CANVASS_REPLIES_FAILURE",t),n();var l=o,c=l.length,d={action:a,instanceId:r,isUserMessageHistory:s,messageId:u.messageId,sortBy:i};"showPrev"===a&&(l.reverse(),d.prevIndex=c===u.count?l[0].index:null),d.replyList=l,e.dispatch("CANVASS_REPLIES_SUCCESS",d),n()}))}r.displayName="loadReplies",t["default"]=r,e.exports=t["default"]},3380:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var a=e.getStore(o["default"]).getState(),s=Object.assign({apiVersion:a.apiVersion,cpNamespace:a.cpNamespace},t);e.service.read("canvass.smartlinks",s,{},(function(a,s){if(a||!s||s.error)return e.dispatch("CANVASS_GET_ENHANCE_URL_FAILURE",a),n();e.dispatch("CANVASS_GET_ENHANCE_URL_SUCCESS",{data:s,messageId:t.messageId}),n()}))};var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};e.exports=t["default"]},3381:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var a=e.getStore(o["default"]).getState(),s=(t=Object.assign({apiVersion:a.apiVersion,cpNamespace:a.cpNamespace,lang:a.lang,region:a.region,namespace:a.namespace,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},t)).sticker,i=t.forReply,l=t.enhancedLink,u="TEXT",c={userText:t.content,contextUrl:t.parentContextUrl||t.contextUrl,contextDisplayText:t.parentContextDisplayText||t.contextDisplayText,details:[],mentions:t.mentions||[],userLabels:t.userLabels||[],visibilityType:"PUBLIC"};Array.isArray(s)&&s.length?u="IMAGE":l&&(u="LINK");if("IMAGE"===u){var d=Object.assign({},s[0]);d.animated=!0,(d=r(d)).resolutions=s.map(r),c.details=[{type:"IMAGE",image:d,attribution:{name:t.author||"",source:"tumblr"}}]}else"LINK"===u&&(delete l.messageId,c.details=[l]);c=JSON.stringify(c),e.service.create(i?"canvass.replyMessage_ns":"canvass.postMessage_ns",{apiVersion:t.apiVersion,context:t.context,cpNamespace:t.cpNamespace,messageId:t.messageId,namespace:t.messageNamespace||t.namespace,lang:t.lang,region:t.region,oauthConsumerKey:t.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret},c,{},(function(a,s){if(a||!s||s.error)return e.dispatch("CANVASS_POST_FAILURE",t),n();s.inReplyTo=t.replyId,s.instanceId=t.instanceId,s.isUserMessageHistory=t.isUserMessageHistory,e.dispatch("CANVASS_POST_SUCCESS",s),n()}))};var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};function r(e){return e.mimeType="image/gif",e}e.exports=t["default"]},3382:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(1181),o=(a=s)&&a.__esModule?a:{"default":a};function r(e,t,n){var a=e.getStore(o["default"]).getState(),s=JSON.stringify({eventType:t.eventType,messageId:t.messageId}),r={apiVersion:a.apiVersion,context:t.context,cpNamespace:a.cpNamespace,eventType:t.eventType,namespace:t.namespace||a.namespace,lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret};e.service.create("canvass.sendHeartbeat_ns",r,s,{},(function(t,a){t||!a||a.error?e.dispatch("CANVASS_HEARTBEAT_FAILURE",t):e.dispatch("CANVASS_HEARTBEAT_SUCCESS",r),n()}))}r.displayName="sendHeartbeat",t["default"]=r,e.exports=t["default"]},3383:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=b(n(4)),o=n(2),r=b(o),i=b(n(2249)),l=b(n(1280)),u=b(n(339)),c=n(1248),d=b(n(1)),f=b(n(182)),p=n(1603),m=b(n(1312)),h=b(n(1630)),g=b(n(2792)),y=b(n(329)),v=n(85),x=n(321);function b(e){return e&&e.__esModule?e:{"default":e}}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,l["default"])(n,["handleNewSearch","handleRelatedTagsLoadEvent","handleSelectTag"]),n.state={relatedTags:n.props.relatedTags,selectedTags:n.props.selectedTags},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"handleRelatedTagsLoadEvent",value:function(){var e=this.context,t=this.state,n=t.selectedTags,a=this.getUpdatedRelatedTags(t.relatedTags,n,e.tagsAnd),s=e.i13n.getI13nNode().getMergedModel();s.cat=n&&n.size?n.join(","):"",s.elm="cmmt_side_convo",s.slk=a?a.size:0,(0,c.fireRapidEvent)("secvw",s)}},{key:"componentWillReceiveProps",value:function(e){this.loadEventFired||(this.loadEventFired=!0,this.handleRelatedTagsLoadEvent()),this.setState({relatedTags:e.relatedTags,enableRelatedTags:e.enableRelatedTags})}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"handleClickOutside",value:function(e){this.props.handleRemoveRelatedTags()}},{key:"handleNewSearch",value:function(){var e=this.context;e.executeAction(h["default"],{instanceId:e.instanceId,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,selectedTags:this.state.selectedTags.join(",")}),this.props.handleRemoveRelatedTags(),(0,c.fireRapidPageView)("trendingTags")}},{key:"removeSelectedTag",value:function(e){var t=(0,u["default"])(this.state.selectedTags);if(t&&t.size){var n=t.filter((function(t){return e!==t}));this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}}},{key:"handleGetNewRelatedTags",value:function(e){var t=this.context;t.executeAction(g["default"],{context:t.context,tagsAnd:(0,p.joinFilterTags)(t.tagsAnd,e),tagsOr:t.tagsOr,instanceId:t.instanceId})}},{key:"handleSelectTag",value:function(e){var t=(this.state.selectedTags?(0,u["default"])(this.state.selectedTags):f["default"].List()).push(e.get("tag"));this.setState({selectedTags:t}),this.handleGetNewRelatedTags(t)}},{key:"renderSelectedTags",value:function(){var e=this.state.selectedTags;if(e&&e.size){var t={pos:e&&e.size||0,outcm:"remove"};return r["default"].createElement("div",{className:"Mb(10px)"},e.map((function(e,n){var a="#"+e;return r["default"].createElement(c.I13nButton,{key:e,className:"D(ib) Cur(p) Wob(ba) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px)",i13nModel:(0,c.getI13nModel)("related-tags",Object.assign({slk:a,cpos:n},t)),onClick:this.removeSelectedTag.bind(this,e)},r["default"].createElement("span",null,a),r["default"].createElement("div",{className:"D(ib) Pos(r) Ta(c) T(2px) Mstart(8px) W(16px) H(16px) Bdc(t) Bdrs(50%) C($c-fuji-grey-g) Bgc($c-fuji-blue-1-a):h"},r["default"].createElement(x.Icon,{asset:y["default"],width:13,height:13,color:"#878c91",className:"Va(bl)! Fill(#fff)!:h Stk(#fff)!:h"})))}),this))}}},{key:"getUpdatedRelatedTags",value:function(e,t,n){if(e&&e.size){var a=n?n.split(","):[],s=t&&t.size?t.join(",").split(","):[],o=a.concat(s);return e.filter((function(e){return-1===o.indexOf(e.get("tag"))}))}}},{key:"renderTags",value:function(){var e=this.state,t=e.relatedTags,n=e.selectedTags,a=this.getUpdatedRelatedTags(t,n,this.context.tagsAnd),s=n&&n.size;if(!a||0===a.size)return r["default"].createElement("div",{className:"Mt(4px) Fz(11px) C($c-fuji-grey-f) Lh(14px)"},r["default"].createElement(v.FormattedMessage,{id:s?"CANVASS_RELATED_TAGS_NO_MORE_TAGS_TO_FILTER_MESSAGE":"CANVASS_RELATED_TAGS_CURRENTELY_NO_TAGS_TO_FILTER_MESSAGE"}),r["default"].createElement("span",null," "),s?r["default"].createElement(v.FormattedMessage,{id:"CANVASS_RELATED_TAGS_APPLY_MESSAGE"}):undefined);var o={pos:t&&t.size||0,outcm:"select"};return r["default"].createElement("div",{className:"Mt(6px) relatedTags"},a.map((function(e,t){var n="#"+e.get("tag");return r["default"].createElement(c.I13nButton,{key:n,className:"D(ib) Wob(ba) Cur(p) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px) Bgc($c-fuji-blue-1-a):h C(#fff):h",i13nModel:(0,c.getI13nModel)("related-tags",Object.assign({slk:n,cpos:t},o)),onClick:this.handleSelectTag.bind(this,e)},n)}),this))}},{key:"renderHeading",value:function(){var e=this.context.tagsAnd;e=e?"#"+e.replace(/,/g,", #"):"";var t=this.state.selectedTags&&this.state.selectedTags.size;return r["default"].createElement("div",{className:"Mb(8px) Fz(15px) Fw(b)"},e?e+" +":t?r["default"].createElement(v.FormattedMessage,{id:"CANVASS_SELECTED_TAGS"}):undefined,!t&&e?r["default"].createElement("div",{className:"D(ib) W(65px) Mstart(5px) BdB Bdc(#bfbfc5) Bdbw(1px)"}):undefined)}},{key:"render",value:function(){var e="smartphone"===(0,d["default"])(this.context,["session","dimensions","device"]),t=i["default"].dedupe("related-tags ignore-react-onclickoutside W(260px) Pos(a) T(45px) Px(20px) Pt(15px) Pb(20px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)",{"Start(75px)":!e}),n=!(this.props.selectedTags&&this.props.selectedTags.size||this.state.selectedTags&&this.state.selectedTags.size),a=n?null:this.handleNewSearch,s=i["default"].dedupe("Mt(16px) Fz(13px) M(0) Lh(n) H(35px) W(70px)",{"Cur(d)! C($c-fuji-grey-e) Bgc($c-fuji-grey-c) Bgc($c-fuji-grey-c):h":n});return r["default"].createElement("div",{className:t},r["default"].createElement(c.I13nButton,{className:"related-tags-close-btn Pos(a) End(0) T(0) O(n)",i13nModel:(0,c.getI13nModel)("related-tags",{slk:"cancel"}),onClick:this.props.handleRemoveRelatedTags},r["default"].createElement(x.Icon,{asset:y["default"],width:16,height:16,color:"#b9bdc5",className:"Fill(#000)!:h"})),this.renderHeading(),this.renderSelectedTags(),r["default"].createElement("div",{className:"C($c-fuji-grey-l)"},r["default"].createElement(v.FormattedMessage,{id:"CANVASS_RELATED_TAGS_FILTER_MESSAGE"})),this.renderTags(),r["default"].createElement(c.I13nButton,{onClick:a,i13nModel:(0,c.getI13nModel)("related-tags",{slk:"apply"}),className:i["default"].get("btn btn-primary",s)},r["default"].createElement(v.FormattedMessage,{id:"CANVASS_APPLY"})))}}]),t}(o.PureComponent);S.contextTypes={componentConfig:s["default"].object.isRequired,configStoreState:s["default"].object,context:s["default"].string,contextDisplayText:s["default"].string,contextUrl:s["default"].string,executeAction:s["default"].func,getStore:s["default"].func,i13n:s["default"].object,instanceId:s["default"].string,session:s["default"].object,tags:s["default"].string,tagsAnd:s["default"].string,tagsOr:s["default"].string},t["default"]=(0,m["default"])(S),e.exports=t["default"]},3384:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=m(n(4)),o=n(2),r=m(o),i=m(n(1280)),l=m(n(1)),u=n(1248),c=m(n(329)),d=n(85),f=n(321),p=n(322);function m(e){return e&&e.__esModule?e:{"default":e}}var h=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,i["default"])(a,["handleCloseFlyout","handleOpenFlyout","handleToggleFlyout","renderFlyout"]),a.state={flyoutOpened:!1,isDesktop:"desktop"===(0,l["default"])(n.session,["dimensions","device"])},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened})}},{key:"handleOpenFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"handleCloseFlyout",value:function(){this.setState({flyoutOpened:!1})}},{key:"renderFlyout",value:function(e){if(this.state.flyoutOpened){var t=void 0,n=e.POSITIVE,a=e.NEUTRAL,s=e.NEGATIVE;return t=r["default"].createElement(d.FormattedHTMLMessage,n>=a&&n>=s?{id:"CANVASS_SENTIMENTS_POSITIVE",values:{className:"C($c-fuji-green-1-b)"}}:a>=n&&a>=s?{id:"CANVASS_SENTIMENTS_NEUTRAL",values:{className:"C($c-fuji-orange-b)"}}:{id:"CANVASS_SENTIMENTS_NEGATIVE",values:{className:"C($c-fuji-red-2-a)"}}),r["default"].createElement("div",{className:"arrow_box Pos(a) End(0) W(150px) Whs(pl) Ta(c) Fw(500) T(28px) P(12px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)"},this.state.isDesktop?null:r["default"].createElement(u.I13nButton,{i13nModel:(0,u.getI13nModel)("sentiments-close-tap"),onClick:this.handleCloseFlyout,className:"sentiments-close-btn Pos(a) End(0) P(0) Mend(2px) T(0) O(n)"},r["default"].createElement(f.Icon,{asset:c["default"],width:16,height:16,color:"#b9bdc5"})),t)}}},{key:"renderSentiment",value:function(e,t,n){return r["default"].createElement("span",null,r["default"].createElement("span",{className:"W(15px) H(15px) D(ib) Va(tt) Bgz(330%) Bg(sentimentsImg) "+n}),r["default"].createElement("span",{className:"Pstart(3px) Fz(11px) Fw(b) "+t},e+"%"))}},{key:"componentDidUpdate",value:function(e,t){var n=this.state.flyoutOpened;t.flyoutOpened!==n&&n&&this.state.isDesktop&&(0,u.fireRapidClick)(Object.assign({},this.context.i13n.getI13nNode().getMergedModel(),(0,u.getI13nModel)("sentiments-tap"),{itc:2}))}},{key:"render",value:function(){var e=this.props.sentiments,t=this.state.isDesktop;if(!e||0===e.size)return null;var n={},a=0;return e.forEach((function(e){var t=e.get("count");n[e.get("sentiment")]=t,a+=t})),a<=0?null:(n.POSITIVE=Math.round(n.POSITIVE/a*100)||0,n.NEUTRAL=Math.round(n.NEUTRAL/a*100)||0,n.NEGATIVE=100-n.POSITIVE-n.NEUTRAL,r["default"].createElement(p.I13nDiv,{bindClickEvent:!t,className:this.props.className,i13nModel:(0,u.getI13nModel)("sentiments-tap"),onClick:t?null:this.handleToggleFlyout,onMouseEnter:this.handleOpenFlyout,onMouseLeave:this.handleCloseFlyout},this.renderFlyout(n),this.renderSentiment(n.POSITIVE,"C($c-fuji-green-1-b) Pend(6px)","Bgp(0)"),this.renderSentiment(n.NEUTRAL,"C($c-fuji-orange-b) Pend(6px)","Bgpx(50%)"),this.renderSentiment(n.NEGATIVE,"C($c-fuji-red-2-a)","Bgpx(100%)")))}}]),t}(o.PureComponent);h.contextTypes={i13n:s["default"].object,intl:s["default"].object,session:s["default"].object},t["default"]=h,e.exports=t["default"]},3385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TumblrStickers=undefined;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=g(n(4)),r=n(2),i=g(r),l=g(n(2100)),u=g(n(333)),c=n(85),d=n(1248),f=g(n(3386)),p=g(n(183)),m=g(n(2485)),h=g(n(3387));function g(e){return e&&e.__esModule?e:{"default":e}}var y=(0,c.defineMessages)({placeholder:{id:"CANVASS_SEARCH_GIF"}}),v=t.TumblrStickers=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!0,search:"popular"},n.handleSearch=(0,u["default"])(n.handleSearch.bind(n),700),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentWillMount",value:function(){this.context.executeAction(f["default"],{})}},{key:"handleSearch",value:function(){var e=this.refs.search&&this.refs.search.value||"popular";this.setState({isLoading:!0,search:e});var t={search:e},n=this.props.tumblrData.getIn([e,"offset"]);t.offset=n||0,this.context.executeAction(f["default"],t),(0,d.fireRapidEvent)("secvw",{slk:"gif-search-"+e,elm:"cmmt_gif",outcm:"show",context:this.context.context,cat:this.context.tags,itc:1,t3:n||!1})}},{key:"componentWillReceiveProps",value:function(e){e.tumblrData&&this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.search,s=this.props.tumblrData,o=s.getIn([n,"error"]),r=this.context.intl,u=s.getIn([n,"stickers"]),c=s.getIn([n,"authors"]),d=parseInt(s.getIn([n,"offset"]),10);u=u?u.toJS():[];var f=l["default"].dedupe("canvass-tumblr-stickers Pos(r) Pb(15px) H(145px) tumblr D(b) W(100%)",{"H(65px)":!this.state.isLoading&&!u.length});return i["default"].createElement("div",{className:f},i["default"].createElement(h["default"],a({},this.props,{authors:c,error:o,handleSearch:this.handleSearch,isLoading:t,offset:d,stickers:u,tumblrData:undefined})),i["default"].createElement("input",{"aria-label":r.formatMessage({id:"CANVASS_SEARCH_GIFS"}),autoFocus:!0,className:"D(ib) M(0) Bd(n) H(21px) Bxsh(n) O(n) Fz(16px) canvass-tumblr-stickers-search Pos(r) B(-16px) Start(50px) Z(1)",onInput:this.handleSearch,ref:"search",placeholder:r.formatMessage(y.placeholder),type:"text"}))}}]),t}(r.PureComponent);v.contextTypes={context:o["default"].string,executeAction:o["default"].func.isRequired,intl:o["default"].object,tags:o["default"].string},t["default"]=(0,p["default"])(v,[m["default"]],(function(e){return{tumblrData:e.getStore(m["default"]).get("data")}}))},3386:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t,n){var o=e.getStore(a["default"]).getState(),r=Object.assign({lang:o.lang,region:o.region,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret},t),i=t.search||"popular",l=e.getStore(s["default"]).get(["data",i]);if(l&&l.get("stickers")&&!t.offset)return e.dispatch("TUMBLR_RELOAD"),n();e.service.read("popular"===i?"canvass.getPopularGifs":"canvass.getGifs",r,(function(a,s){!a&&s&&s.gifresult&&0!==s.gifresult.length?e.dispatch("TUMBLR_LOAD_GIFS",{key:i,data:s,offset:t.offset||0}):e.dispatch("TUMBLR_LOAD_GIFS_ERROR",{key:i,error:a,offset:t.offset||0}),n()}))};var a=o(n(1181)),s=o(n(2485));function o(e){return e&&e.__esModule?e:{"default":e}}e.exports=t["default"]},3387:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stickers=undefined;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=f(n(4)),o=n(2),r=f(o),i=f(n(1280)),l=n(322),u=f(n(333)),c=n(1248),d=n(85);function f(e){return e&&e.__esModule?e:{"default":e}}var p=(0,l.createI13nNode)("div",{bindClickEvent:!0}),m=t.Stickers=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,i["default"])(n,["handlePostSticker"]),n.onScroll=(0,u["default"])(n.onScroll.bind(n),300),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.paginating=!1}},{key:"componentDidUpdate",value:function(){this.paginating&&this.scrollContainer&&!this.props.isLoading&&setTimeout(function(){this.scrollContainer.scrollLeft+=50,this.paginating=!1}.bind(this),0)}},{key:"handlePostSticker",value:function(e,t){this.props.onStickerClick&&this.props.onStickerClick(e,t)}},{key:"onScroll",value:function(){if(this.scrollContainer=this.refs.sticker,this.scrollContainer&&this.scrollContainer.getBoundingClientRect){var e=this.scrollContainer.getBoundingClientRect();this.props.offset&&!this.props.error&&e&&this.scrollContainer.scrollLeft+e.width+200>=this.scrollContainer.scrollWidth&&(this.paginating=!0,this.props.handleSearch())}}},{key:"renderErrorBox",value:function(){var e=this.props.stickers;return!this.props.error||e&&e.length?null:r["default"].createElement("div",{className:"stickers-error-box H(100%) Bg(#fff) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"},r["default"].createElement("span",{className:"Pos(r) T(45%)"},r["default"].createElement(d.FormattedMessage,{id:"CANVASS_NO_GIFS_FOUND"})))}},{key:"renderLoadingBox",value:function(){return this.props.isLoading?r["default"].createElement("div",{className:"stickers-loading-box H(100%) Bg(bgLoading) Op(0.5) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"}):null}},{key:"renderStickersList",value:function(){var e=this.props.stickers;if(!e||!e.length)return null;return r["default"].createElement("div",{className:"Pos(r) D(b) Bgc(#fff) Maw(100%)!"},r["default"].createElement("div",{className:"Row Pos(r)"},r["default"].createElement("div",{ref:"sticker",className:"stickers-list H(100%) Ovx(s) Ovy(h) Whs(nw) W(100%) Ovs(touch)",onScroll:this.onScroll},e.map(this.renderItem,this))))}},{key:"renderItem",value:function(e,t){for(var n=this.context,a=this.props,s=a.authors,o=a.overlayClasses,i=a.overlayLabelClasses,l=e[e.length-1],u=e.length-1;u>=0;u--)if(e[u].height>=145){l=e[u];break}var f=l.url,m=(0,c.getI13nModel)("tumblr-post",{slk:"gif-"+f,context:n.context,cat:n.tags});return r["default"].createElement(p,{i13nModel:m,key:f,onClick:this.handlePostSticker.bind(this,e,s.get(t)),className:"D(ib) Pos(r) Mend(4px) sticker-item"},r["default"].createElement("img",{className:"Cur(p)",height:145,width:Math.round(145/l.height*l.width),src:f}),r["default"].createElement("div",{className:o},r["default"].createElement("p",{className:i},r["default"].createElement(d.FormattedMessage,{id:"CANVASS_POST"}))))}},{key:"render",value:function(){return r["default"].createElement("div",{className:"H(100%) Va(t) Pstart(16px) Pos(r) Maw(100%)! stickers"},this.renderLoadingBox()||this.renderErrorBox(),this.renderStickersList())}}]),t}(o.PureComponent);m.contextTypes={context:s["default"].string,tags:s["default"].string},m.defaultProps={overlayClasses:"sticker-overlay W(100%) H(100%) Pos(a) T(0) Start(0) Bg(overlaySticker):h Op(0) Op(1):h Trsdu(.42s) Cur(p)",overlayLabelClasses:"post-label Pos(r) Ta(c) Fw(600) Fz(14px) W(54px) H(20px) T(50%) Start(50%) Translate(-50%,-50%) P(6px) C(#fff) Bgc(#222) Bdrs(2px)",stickers:[]},t["default"]=m},3388:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=f(n(4)),o=n(2),r=f(o),i=f(n(1280)),l=n(1248),u=f(n(1)),c=f(n(1084)),d=n(321);function f(e){return e&&e.__esModule?e:{"default":e}}var p=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={hover:!1},e.isReadOnly||(0,i["default"])(a,["handleSelection"]),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"componentWillMount",value:function(){this.handleMouseEnter=this.onMouseEnter.bind(this),this.handleMouseLeave=this.onMouseLeave.bind(this)}},{key:"handleSelection",value:function(){var e=this.props;e.isReadOnly||e.handleSelection&&e.handleSelection(e.isSelected?null:e.value)}},{key:"render",value:function(){var e=this.props,t=e.config,n=(0,c["default"])("Fz(12px) Px(8px) Mend(4px) Va(m) Bdrs(3px)",{"C($c-fuji-grey-g) Bgc($c-fuji-grey-b) Cur(d) Py(3px)":e.isReadOnly,"Bdc($c-fuji-grey-c) Pt(4px) Bds(s)":!e.isReadOnly,"Bgc($c-fuji-grey-b) Bdc($c-fuji-grey-c) Bds(s)":this.state.hover&&!e.isSelected,"C(#fff) Bgc($c-fuji-purple-1-a) Bdc($c-fuji-purple-1-a) Bds(s)":e.isSelected}),a=this.props.isSelected?"#fff":e.isReadOnly?"#333":"#000";if(e.isReadOnly)return r["default"].createElement("div",{className:n},t.icon?r["default"].createElement(d.Icon,{name:t.icon.name,className:t.icon.className+" Cur(d)",color:a,height:18,style:t.icon.style,width:18}):undefined,t.title);var s=(0,l.getI13nModel)("userlabels-tap",{slk:e.isSelected?"unselect userlabel "+e.value:"select userlabel "+e.value}),o="desktop"===(0,u["default"])(this.context,["session","dimensions","device"]);return r["default"].createElement(l.I13nButton,{className:n,i13nModel:s,onMouseEnter:o?this.handleMouseEnter:null,onMouseLeave:o?this.handleMouseLeave:null,onClick:this.handleSelection,type:"button"},t.icon?r["default"].createElement(d.Icon,{name:t.icon.name,className:t.icon.className,color:a,height:18,style:t.icon.style,width:18}):undefined,t.title)}}]),t}(o.PureComponent);p.contextTypes={session:s["default"].object},p.defaultProps={isReadOnly:!0,isSelected:!1},t["default"]=p,e.exports=t["default"]},3389:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=f(n(4)),o=n(2),r=f(o),i=f(n(1)),l=n(1248),u=f(n(123)),c=f(n(2784)),d=n(321);function f(e){return e&&e.__esModule?e:{"default":e}}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={hover:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"handleRating",value:function(e){var t=this.context,n=this.props;t.executeAction(c["default"],{context:n.contextId,isUserMessageHistory:t.isUserMessageHistory||null,instanceId:t.instanceId,messageId:n.messageId,namespace:n.messageNamespace,voteType:e===n.voteType?"clear":n.voteType,replyId:n.replyId,pos:"number"==typeof t.pos?t.pos:null})}},{key:"bindHandleRating",value:function(e){this.handleVote=(0,u["default"])(this.handleRating.bind(this,e.vote),1500,{trailing:!1})}},{key:"componentWillMount",value:function(){"desktop"===(0,i["default"])(this.context,["session","dimensions","device"])&&(this.handleMouseEnter=this.onMouseEnter.bind(this),this.handleMouseLeave=this.onMouseLeave.bind(this)),this.bindHandleRating(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.bindHandleRating(e)}},{key:"render",value:function(){var e,t,n=this.props,a=n.vote,s=n.voteType,o=n.thumbName,i=n.size,u=this.context.intl,c=this.handleVote,f=void 0;f=this.state.hover||a===s?n.selectedColor:n.color,t=a===s?n.selectedIcon:n.icon,e=(0,l.getI13nModel)("vote",{rcv_msg_id:n.replyId||n.messageId,slk:a===s?"undo vote "+o:"vote "+o});var p=(n.replyId||n.messageId)+t,m=n.reactionStats[s+"VoteCount"]||0,h=u.formatNumber(m),g=h+" "+u.formatMessage({id:"CANVASS_REACTION_"+o.toUpperCase()});return n.isSignedIn||(c=n.onToggleToolTip),r["default"].createElement(l.I13nButton,{"aria-label":g,className:n.className,onClick:c,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,i13nModel:e},r["default"].createElement(d.Icon,{asset:t,color:f,height:i,key:p,style:{verticalAlign:"middle"},width:i}),m>0?r["default"].createElement("span",{className:"D(ib) Mstart(4px) Va(m) Fz(12px) C($c-fuji-grey-g)"},h):undefined)}}]),t}(o.PureComponent);p.contextTypes={configStoreState:s["default"].object.isRequired,executeAction:s["default"].func.isRequired,instanceId:s["default"].string,intl:s["default"].object,isUserMessageHistory:s["default"].bool,pos:s["default"].number,session:s["default"].object},p.defaultProps={className:"O(n) M(0) P(0) Bd(n)",color:"#878c91",reactionStats:{},selectedColor:"#188fff",size:14,thumbName:"up",voteType:"up"},t["default"]=p,e.exports=t["default"]},3390:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=C(n(4)),o=n(2),r=C(o),i=C(n(2249)),l=C(n(1280)),u=n(34),c=n(1248),d=C(n(1)),f=C(n(1312)),p=C(n(2482)),m=C(n(329)),h=C(n(2484)),g=n(85),y=C(n(2794)),v=C(n(3391)),x=n(322),b=n(321),S=n(1855);function C(e){return e&&e.__esModule?e:{"default":e}}var _=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,l["default"])(n,["handleKeyDown","handleLoadEvent","handleShowMessages","onScrollHandler"]),n.state={loadingNextComments:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"getChildContext",value:function(){return{isUserMessageHistory:!0,userMessageHistoryGuid:this.props.userComments.get("guid")}}},{key:"handleClickOutside",value:function(){this.props.handleRemoveUserComments&&this.props.handleRemoveUserComments()}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleLoadEvent",value:function(){var e=this.context.i13n.getI13nNode().getMergedModel();e.slk="canvass-load",(0,c.fireRapidEvent)("secvw",e)}},{key:"onScrollHandler",value:function(e){var t=this.scrollingElement,n=t.scrollTop,a=t.scrollHeight,s=e.deltaY,o=s>0;return o&&s>a-t.clientHeight-n?(t.scrollTop=a,this.cancelScrollEvent(e)):!o&&-s>n?(t.scrollTop=0,this.cancelScrollEvent(e)):void 0}},{key:"cancelScrollEvent",value:function(e){return e.stopImmediatePropagation(),e.preventDefault(),e.returnValue=!1,!1}},{key:"componentDidMount",value:function(){this.context.handleOverlay(!0),this.scrollingElement=(0,u.findDOMNode)(this.refs.usercomments),this.scrollingElement.addEventListener("wheel",this.onScrollHandler,!1),this.scrollingElement.focus(),this.handleLoadEvent(),(0,c.fireRapidPageView)("userHistory")}},{key:"componentWillUnmount",value:function(){this.scrollingElement.removeEventListener("wheel",this.onScrollHandler,!1)}},{key:"componentWillReceiveProps",value:function(e){this.setState({loadingNextComments:!1})}},{key:"componentDidUpdate",value:function(e,t){e.userComments.get("guid")!==this.props.userComments.get("guid")&&this.handleLoadEvent()}},{key:"handleShowMessages",value:function(e){var t=this.props.userComments,n={guid:t.get("guid"),image:t.get("image"),name:t.get("name"),sortBy:t.get("sortBy"),instanceId:this.context.instanceId};"showNext"===e&&(this.setState({loadingNextComments:!0}),n.nextIndex=t.get("nextIndex"),n.showNextClicked=!0),this.context.executeAction(p["default"],n)}},{key:"renderShowNextButton",value:function(){var e=this;return this.props.userComments.get("showLoadNext")?r["default"].createElement(c.I13nButton,{i13nModel:(0,c.getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:i["default"].get("btn btn-secondary btn-spacing btn-sm-fullwidth","showMore D(b) Mx(a) Pos(r)")},r["default"].createElement(g.FormattedMessage,{id:this.state.loadingPreviousComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"})):null}},{key:"render",value:function(){var e=this.context,t=this.props,n=t.isFullScreen,a=t.userComments,s=a.get("messageList"),o=a.get("count"),l=a.get("guid"),u=a.get("image"),f=a.get("name"),p=a.get("sortBy"),g=s&&s.size?s.toJS():[],C=i["default"].dedupe("user-comments Pos(a) Ovx(s) Ovs(touch) O(n) Bxz(bb) Start(50%) W(90%) Mstart(-45%) Bgc(#fff) Z(9) Bd Bdrs(5px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) ",{"Pos(f)":n}),_={height:o?S.USER_HISTORY_HEIGHT:"auto",top:t.top};return n&&o&&(_.height=Math.min(window.innerHeight-2*S.COMMUNITY_BAR_HEIGHT,S.USER_HISTORY_HEIGHT)),r["default"].createElement(x.I13nDiv,{"aria-label":e.intl.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:f}),className:C,i13nModel:{sec:"cmmt_his"},onKeyDown:this.handleKeyDown,ref:"usercomments",role:"dialog",style:_,tabIndex:"-1"},r["default"].createElement(c.I13nButton,{"aria-label":e.intl.formatMessage({id:"CANVASS_CANCEL"}),className:"user-comments-close-btn O(n):a O(n):h Pos(a) Z(1) M(10px) P(0) End(0) T(0)",i13nModel:(0,c.getI13nModel)("user-close-tap"),onClick:t.handleRemoveUserComments},r["default"].createElement(b.Icon,{asset:m["default"],width:30,height:30,color:"#fff",className:"close-icon Cur(p)"})),r["default"].createElement(v["default"],{className:"user-info",key:"userinfo",creator:l,name:f,imageUrl:u,count:o,isUserMessageHistory:!0}),o>0?r["default"].createElement("div",{className:"Px(24px) Pt(12px)"},r["default"].createElement(y["default"],{arrangement:(0,d["default"])(e.componentConfig,["ui","sortTabs","arrangement"]),key:"usercomments-sorting-tabs",count:o,userMessageHistoryName:f,userMessageHistoryImage:u,sortBy:p}),r["default"].createElement(h["default"],{list:g,sortBy:p,itemClassName:"Py(12px)"}),this.renderShowNextButton()):null)}}]),t}(o.PureComponent);_.contextTypes={componentConfig:s["default"].object.isRequired,configStoreState:s["default"].object,contextDisplayText:s["default"].string,contextUrl:s["default"].string,executeAction:s["default"].func,handleOverlay:s["default"].func,i13n:s["default"].object,intl:s["default"].object,instanceId:s["default"].string,session:s["default"].object},_.childContextTypes={isUserMessageHistory:s["default"].bool,userMessageHistoryGuid:s["default"].string},t["default"]=(0,f["default"])(_),e.exports=t["default"]},3391:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=c(n(4)),o=n(2),r=c(o),i=c(n(1580)),l=n(1248),u=n(321);function c(e){return e&&e.__esModule?e:{"default":e}}var d=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"renderCommentsCount",value:function(){var e=this.props.count,t=this.context.intl,n=void 0;return n=1===e?"1 "+t.formatMessage({id:"CANVASS_COMMENT"}):t.formatNumber(e)+" "+t.formatMessage({id:"CANVASS_COMMENTS"}),r["default"].createElement("div",{className:"user-comments-count Pt(10px) Fz(12px) Fw(600) C(#fff)"},r["default"].createElement(u.Icon,{className:"comment-icon Mend(5px)",color:"#fff",cursorClass:"Cur(d)",height:14,name:"comments",style:{verticalAlign:"middle"},width:14}),n)}},{key:"renderAvatar",value:function(e){var t=this.context,n=this.props,a=n.imageUrl;if(n.creator===t.guid){var s=t.session.dimensions;return r["default"].createElement(l.I13nAnchor,{className:"avatar W(60px) Fl(start) Mend(20px) Pos(r)",href:"https://login.yahoo.com/account/personalinfo/?.intl="+s.intl+"&.lang="+s.lang,target:"_blank",title:t.intl.formatMessage({id:"CANVASS_EDIT_PROFILE"})},r["default"].createElement(i["default"],{src:a,name:e,enableAlphatar:!0,size:60}),r["default"].createElement("div",{className:"StretchedBox Bg(gradient) Bdrs(48%) Op(0.7)"}),r["default"].createElement(u.Icon,{className:"Pos(a) B(6px) Start(20px)",color:"#fff",name:"camera",height:20,width:20}))}return r["default"].createElement(i["default"],{src:a,name:e,enableAlphatar:!0,size:60,className:"avatar W(60px) Fl(start) Mend(20px)"})}},{key:"getUserProfile",value:function(){var e=this.props.name||this.context.intl.formatMessage({id:"CANVASS_ANONYMOUS"});return r["default"].createElement("div",{key:e,className:"user-profile"},this.renderAvatar(e),r["default"].createElement("div",{className:"username Pt(4px) Fw(b) Fz(20px) C(#fff)"},e),this.renderCommentsCount())}},{key:"render",value:function(){return r["default"].createElement("div",{className:"user-info P(24px) Pb(20px) Pend(36px) Cf Bgc(#1276b9)",style:{backgroundImage:"url(https://s.yimg.com/cv/ae/comments/userbg.png)"}},this.getUserProfile())}}]),t}(o.PureComponent);d.contextTypes={guid:s["default"].string,intl:s["default"].object,session:s["default"].object},t["default"]=d,e.exports=t["default"]},3392:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(85),o=u(n(3393)),r=n(321),i=(u(n(4)),n(2)),l=u(i);function u(e){return e&&e.__esModule?e:{"default":e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={updating:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.count!==e.count})}},{key:"componentDidUpdate",value:function(){var e=this;e.state.updating&&setTimeout((function(){e.setState({updating:!1})}),500)}},{key:"render",value:function(){var e=this.props,t=e.count;return t?l["default"].createElement("div",{className:"Fl(end) Fz(14px) Fw(500) Trsdu(.5s) Trsp(color) "+(e.className||"")+" "+(this.state.updating?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-g)")},l["default"].createElement(r.Icon,{asset:o["default"],className:"Mend(6px)",color:"#5601ec",height:18,style:{verticalAlign:"text-bottom"},width:18}),l["default"].createElement(s.FormattedMessage,{id:"CANVASS_USERS_VIEWING",values:{count:t}})):null}}]),t}(i.PureComponent);t["default"]=c,e.exports=t["default"]},3393:function(e,t,n){if(void 0===a)var a={};a["groups-fill"]={name:"groups-fill",height:16,width:16,path:"M5 7.667c-1.196 0-2.167-.97-2.167-2.167S3.803 3.333 5 3.333c1.197 0 2.167.97 2.167 2.167S6.197 7.667 5 7.667zM13.167 5.5c0 1.197-.97 2.167-2.167 2.167S8.833 6.697 8.833 5.5 9.803 3.333 11 3.333c1.197 0 2.167.97 2.167 2.167zm1.48 4.38c-.09-.083-.175-.167-.277-.244-.794-.59-2.008-.97-3.37-.97-.343 0-.643.03-.85.058-.086.01-.157.022-.206.03l-.088.016c-.003 0-.005.003-.01.004-.218.037-.44.074-.644.13.12.09.226.187.33.286.504.49.8 1.063.8 1.682v2.13h4.334c.366 0 .667-.302.667-.668V11.27c0-.514-.258-.988-.686-1.39zM8 9.396c-.78-.45-1.833-.73-3-.73-1.362 0-2.575.378-3.37.97-.102.076-.188.16-.275.243-.43.402-.688.876-.688 1.39v1.064c0 .367.3.667.667.667h8v-1.728c0-.514-.258-.988-.686-1.39-.088-.084-.174-.168-.277-.245-.112-.085-.237-.164-.37-.24z"},e.exports&&(e.exports=a["groups-fill"])},977:function(e,t,n){"use strict";e.exports={controllerViews:{CanvassApplet:n(3368)},stores:{CanvassCommentFormStore:n(2250),CanvassConfigStore:n(1181),CanvassLinkEnhancerStore:n(2791),CanvassSentimentsStore:n(2783),CanvassStore:n(1172),CanvassTumblrStore:n(2485)},meta:{dependencies:["tdv2-service-profile"]}}}}]);